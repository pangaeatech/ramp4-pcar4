const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./knowledgeGraphService-ClO6ZVyZ.js","./main-wjLrsw2z.js","./preload-helper-B76NpbEU.js","./main-B_8sIZOq.css","./normalizeUtils-BiO-taLr.js","./normalizeUtilsCommon-DJgDsaWr.js","./utils-DDnzVFtW.js","./utils-3IQe4eYa.js","./Field-DE3-9_9Q.js","./fieldType-a-b4v4ZF.js","./networkEnums-RbNQ-DJH.js","./FeatureSet-DDy_uGyV.js","./GPMessage-DRzT_793.js","./Relationship-C7gk00t0.js"])))=>i.map(i=>d[i]);
import{_ as E}from"./preload-helper-B76NpbEU.js";import{Y as x,d_ as w,dZ as R,de as G,d$ as I,a2 as j,R as O,I as k,e0 as V,e1 as J}from"./main-wjLrsw2z.js";import{t as M}from"./arcade-A46jQcOn.js";import{a as P,p as T,x as Q,q as W,j as b,i as B,y as D,z as C,A as L,E as z,H as q}from"./aiServices-CPeYQatf.js";import{a as c,r as u}from"./enum-5YUFr6E8.js";import{l as H}from"./portalUtils-BZ9NyXFL.js";import{K as U,O as Y,k as Z}from"./projectionUtils-Ck7cBeJK.js";import X from"./PortalItem-CngPoFkL.js";import{p as $,n as tt}from"./project-Bh9-eYf2.js";import{s as et,p as rt,e as nt,i as at,a as it}from"./Relationship-C7gk00t0.js";import"./TimeOnly-5WFwcN0B.js";import"./UnknownTimeZone-B0EljvFV.js";import"./featureConversionUtils-C7q1n0w4.js";import"./OptimizedFeature-Bes7fG-3.js";import"./memoryEstimations-upqF-ypY.js";import"./OptimizedGeometry-ClUotnbt.js";import"./OptimizedFeatureSet-BR8EEvDc.js";import"./FieldsIndex-a2DTlUTr.js";import"./timeZoneUtils-DIizqSwQ.js";import"./ImmutableArray-BPVd6ESQ.js";import"./shared-CPnkzgkx.js";import"./Field-DE3-9_9Q.js";import"./fieldType-a-b4v4ZF.js";import"./WhereClause-CMsXSwnc.js";import"./unitConversion-BKX9dJYI.js";import"./number-RJIVKaa6.js";import"./uuid-Cl5lrJ4c.js";import"./commonProperties-DHiB1uzW.js";import"./utils-DDnzVFtW.js";import"./utils-3IQe4eYa.js";let l=null;async function ot(t){const e=O.geometryServiceUrl??"";if(!e){Z()||await U();for(const r of t)r.container[r.indexer]=Y(r.container[r.indexer],k.WGS84);return}const n=t.map(r=>r.container[r.indexer]),i=new $({geometries:n,outSpatialReference:k.WGS84}),s=await tt(e,i);for(let r=0;r<s.length;r++){const a=t[r];a.container[a.indexer]=s[r]}}async function A(t,e){const n=new X({portal:t,id:e});return await n.load(),l===null&&(l=await E(()=>import("./knowledgeGraphService-ClO6ZVyZ.js").then(i=>i.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url)),await l.fetchKnowledgeGraph(n.url)}function v(t,e,n,i,s){if(t===null)return null;if(w(t)||G(t))return t;if(D(t)||D(t))return t.toJSDate();if(C(t))return t.toStorageFormat();if(L(t))return t.toStorageString();if(z(t)){const r={};for(const a of t.keys())r[a]=v(t.field(a),e,n,i,s),r[a]instanceof I&&s.push({container:r,indexer:a});return r}if(R(t)){const r=t.map(a=>v(a,e,n,i,s));for(let a=0;a<r.length;a++)r[a]instanceof I&&s.push({container:r,indexer:a});return r}return q(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&e?j(t):t:void 0}function st(t,e){if(!t)return t;if(t.spatialReference.isWGS84&&e.spatialReference.isWebMercator)return J(t);if(t.spatialReference.equals(e.spatialReference))return t;throw new c(e,u.WrongSpatialReference,null)}function S(t,e){if(!t)return null;const n={};for(const i in t)n[i]=m(t[i],e);return n}function m(t,e){return t===null?null:R(t)?t.map(n=>m(n,e)):t instanceof rt?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:S(t.properties,e)}:t instanceof nt?{graphType:"object",properties:S(t.properties,e)}:t instanceof at?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:S(t.properties,e)}:t instanceof it?{graphType:"path",path:t.path?t.path.map(n=>m(n,e)):null}:q(t)?st(t,e):w(t)||G(t)||V(t)?t:null}function jt(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(e,n){return t.standardFunctionAsync(e,n,(i,s,r)=>{if(P(r,2,2,e,n),r[0]===null)throw new c(e,u.PortalRequired,n);if(r[0]instanceof M){const d=T(r[1]);let f;return f=e.services?.portal?e.services.portal:x.getDefault(),A(H(r[0],f),d)}if(w(r[0])===!1)throw new c(e,u.InvalidParameter,n);const a=T(r[0]);return A(e.services?.portal??x.getDefault(),a)})},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(e,n){return t.standardFunctionAsync(e,n,async(i,s,r)=>{P(r,2,4,e,n);const a=r[0];if(!Q(a))throw new c(e,u.InvalidParameter,n);const d=r[1];if(!w(d))throw new c(e,u.InvalidParameter,n);l===null&&(l=await E(()=>import("./knowledgeGraphService-ClO6ZVyZ.js").then(o=>o.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url));let f=null;const h=W(r[2],null);if(!(h instanceof b||h===null))throw new c(e,u.InvalidParameter,n);if(h){let o=[];f=v(h,!0,!1,e,o),o=o.filter(p=>!p.container[p.indexer].spatialReference.isWGS84),o.length>0&&await ot(o)}const F=W(r[3],!1),_=new et({openCypherQuery:d,bindParameters:f,provenanceBehavior:F?"include":"exclude"});(a?.serviceDefinition?.currentVersion??11.3)>11.2&&(_.outputSpatialReference=e.spatialReference);const K=(await l.executeQueryStreaming(a,_)).resultRowsStream.getReader(),y=[];try{for(;;){const{done:o,value:p}=await K.read();if(o)break;if(R(p))for(const g of p)y.push(m(g,e));else{const g=[];for(const N of p)g.push(m(p[N],e));y.push(g)}}}catch(o){throw o}return b.convertJsonToArcade(y,B(e),!1,!0)})},t.signatures.push({name:"querygraph",min:2,max:4}))}export{jt as registerFunctions};
