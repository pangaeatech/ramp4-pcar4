const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SelfSnappingEngine-DV9xbOJp.js","./main-wjLrsw2z.js","./preload-helper-B76NpbEU.js","./main-B_8sIZOq.css","./Cyclical-K-a9e6FI.js","./quantityUtils-Beu5Bph5.js","./elevationInfoUtils-fe-wgjs7.js","./ElevationInfo-Cuk6Yfdd.js","./lengthUtils-XtUZYmHh.js","./vec2-ChnYg_BJ.js","./common-DQOJ18NT.js","./vec2f64-Cgb6qxNH.js","./vec32-B2d58gwM.js","./UpdatingHandles-CBdbeOF2.js","./projectionUtils-Ck7cBeJK.js","./GraphicsLayer-BIwQhDbY.js","./GraphicsCollection-DA3gVqqb.js","./Layer-Bp_m3QXA.js","./TimeExtent-DunUFTD-.js","./BlendLayer-QrPo5Hot.js","./layerContainerType-C5CzMsLd.js","./jsonUtils-BzvnS-eb.js","./parser-DnvMkHgv.js","./mat4f32-Djp3mnm5.js","./mat4-DPRg57JE.js","./ScaleRangeLayer-D0dGjZzY.js","./editableLayers-DQL1HwJR.js","./utils-B9iQJ2Oh.js","./Queue-fsp6PtSa.js","./Version-BeJWRrcp.js","./projectVectorToVector-53cNtlQ9.js","./projectPointToVector-wLG66Ug0.js","./geodesicUtils-mJFIZ9e0.js","./asyncUtils-BI9hixG5.js","./Query-KleKJW6A.js","./Field-DE3-9_9Q.js","./fieldType-a-b4v4ZF.js","./vec42-CKs01hkn.js","./vec4f64-DPb6J-GU.js","./plane-C3iMene6.js","./vectorStacks-cQSpnLOv.js","./mat3f64-B5o_lm6j.js","./mat4f64-q_b6UJoq.js","./quatf64-aQ5IuZRd.js","./sphere-DJFCFUk1.js","./mat3-CruJiiUv.js","./geodeticLengthOperator-C9mpMpzD.js","./geodeticCurveType-CirnHLSB.js","./earcut-D9gy186-.js","./triangle-CrBjRSOr.js","./lineSegment-HhQH2y7K.js","./spatialReferenceEllipsoidUtils-CYJizbww.js","./GridSnappingEngine-dJmTPCkh.js","./normalizeUtils-BiO-taLr.js","./normalizeUtilsCommon-DJgDsaWr.js","./utils-DDnzVFtW.js","./utils-3IQe4eYa.js","./scaleUtils-DhTu_gnZ.js","./gridUtils-CDl9QnNC.js","./FeatureSnappingEngine-DOykJF6S.js","./FeatureFilter-CgCVeYkg.js","./floorFilterUtils-DKzVzLpH.js","./layerViewUtils-B65w2uF3.js","./geometryEngine-BZn6akp0.js","./geometryEngineBase-C-7zg03I.js","./_commonjsHelpers-DCkdB7M8.js","./hydrated-DcETXHn2.js","./editingTools-CM2Dt3TR.js","./SnappingVisualizer2D-CJSKhmcN.js","./enums-_AFKM9Yk.js","./TooltipInfoWithCoordinates-BavF4_Yj.js","./PointSnappingHint-C5wco75j.js","./SketchTooltipInfo-Nfb6qmUr.js","./intl-BWrXByQm.js","./MeshTransform-CskJSl2n.js","./quat-DKStbfOm.js","./axisAngleDegrees-ba-g6zsO.js","./meshVertexSpaceUtils-BJM6Zivm.js","./MeshLocalVertexSpace-BFr73FJA.js","./modeUtils-1fSvrGRf.js","./jsxFactory-Bu1kDtUq.js","./uuid-Cl5lrJ4c.js","./sanitizerUtils-CJlLEeXg.js","./a11yUtils-BUg244nq.js","./memoize-DmxaQ-k8.js","./unitFormatUtils-Bq1KmIJa.js","./ByteSizeUnit-BsxeN7wM.js","./index-DEMWGgC0.js","./dynamic-import-helper-BheWnx7M.js","./draw-store-BjeXkkMQ.js","./drapedUtils-utfiskbA.js","./utils-BQBvadb7.js","./widget-CauuX75J.js","./substitute-BUYvwFbg.js","./editPlaneUtils-DZEN0LSt.js","./drawSurfaces-yRAZXyx4.js","./distanceOperator-Bk8g2hZa.js","./Point2D-yI-uny1B.js","./ProjectionTransformation-CCEk1u-B.js","./Envelope2D-N58wWtPO.js","./Transformation2D-CZuEM6rU.js","./SimpleGeometryCursor-B92kdZ15.js","./OperatorDefinitions-DP7_WWTp.js","./apiConverter-e5T8In1v.js","./jsonConverter-BBGCaYPY.js","./simplifyOperator-B3KgGOx3.js","./operatorSimplify-CoSXDpoE.js","./mat2d-D9DBP-jx.js","./mat2df64-CH-gvrN5.js","./ReactiveSet-CwVjb1Y_.js","./diffUtils-vX0-Q9_W.js","./ViewingMode-Chk7YAAL.js","./SnappingContext-D-1nN-2A.js","./hydratedFeatures-BO4ut1J0.js","./Scheduler-C8f_KTyU.js","./debugFlags-WS_cW9hv.js","./boundedPlane-Dw4l3yuj.js","./cimSymbolUtils-DuIqjD_l.js","./utils-BV7DBUkI.js","./defaultCIMValues-CQAn2izL.js","./GraphicManipulator-BzBSUZsP.js","./colorUtils-CGIegwD7.js","./drawUtils-CueGF8l0.js","./ImageMaterial.glsl-CaAjzY1X.js","./TextOverlayItem-B9VR40XN.js","./Octree-omo0Ryo1.js","./BufferView-BvK5Jz2T.js","./RibbonLine.glsl-xUkAunmA.js","./orientedBoundingBox-DdXEtSoI.js","./computeTranslationToOriginAndRotation-B1uFhUgW.js","./OutputColorHighlightOID.glsl-BCuJD3BV.js","./videoUtils-oRwD115t.js","./requestImageUtils-tElulpnR.js","./basicInterfaces-CZwQPxTp.js","./TextureFormat-1mYWTFa-.js","./enums-UBzvFP7O.js","./Texture-CGyf7NfV.js","./getDataTypeBytes-D2DiHx_d.js","./Indices-CYqKW8Zt.js","./VertexAttribute-BfkzOMLV.js","./glsl-Cj7KC756.js","./BindType-BBwFZqyN.js","./ShaderOutput-Bdd80V3g.js","./renderState-D2jq0MiL.js","./InterleavedLayout-qw26ze1T.js","./types-BKo2foNY.js","./dehydratedFeatureUtils-Bcb49ITe.js","./vec3f32-WCVSSNPR.js","./floatRGBA-y6dZBMDU.js","./ShaderBuilder-CyYjVqIV.js","./DefaultLayouts-DlXNNANZ.js","./triangulationUtils-fAbKvIKq.js","./deduplicate-9f7FYBCN.js","./VertexElementDescriptor-BLyltQyJ.js","./VertexArrayObject-DW3U-luJ.js","./memoryEstimations-upqF-ypY.js","./NestedMap-BwbkO4RU.js","./glUtil-DBmLLAE9.js","./HUDMaterial.glsl-BLnNtkFL.js","./SelectedVertexTooltipInfo-BrpIaJss.js","./IntersectorType-gQim6TH1.js","./TranslateTooltipInfo-C0c6juu7.js","./utils-BRDz2VyU.js","./LRUCache-BB1cebTv.js","./MemCache-BSBM3Sy1.js","./IViewEvents-Bci6PjlS.js","./ExtentScaleTooltipInfo-BqesBkRY.js","./LineCallout.glsl-BonNGxxK.js","./projectionUtils-LODmI47t.js","./HeightModelInfo-ONo8Apys.js","./visualVariableUtils-B2WgDQ6g.js","./dehydratedFeatures-aftNe0Q4.js","./UniqueValueRenderer-ChsEGwbB.js","./commonProperties-DmPwhA7i.js","./colorRamps-4f8nNmtP.js","./ColorStop-xCRZETL3.js","./RendererLegendOptions-BpuKtqzI.js","./styleUtils-kDvAHFL6.js","./rendererConversion-DQNy16rk.js","./RealisticTree.glsl-C_PuLrxO.js","./DefaultMaterial-CB-v3NSz.js","./NormalAttribute.glsl-DLx6-J3X.js","./edgeUtils-CjOtxNaM.js","./OptimizedFeature-Bes7fG-3.js","./OptimizedGeometry-ClUotnbt.js","./optimizedFeatureQueryEngineAdapter-fb8Lz5as.js","./vec2f32-CaVKkSa6.js","./featureConversionUtils-C7q1n0w4.js","./OptimizedFeatureSet-BR8EEvDc.js","./PooledRBush-NmiwKBc6.js","./quickselect-QQC62dOK.js","./popupUtils-B459BCpX.js","./LayerView-Cv0dmbQO.js","./GraphicMover-CDpVbWRg.js","./Box-DAapV3GB.js","./settings-lda-5po6.js","./Reshape-9irFwQHr.js","./symbolUtils-Ck4YRGZx.js","./mat2df32-Dpt2CT5P.js","./webStyleSymbolUtils-lcsgBB-k.js","./devEnvironmentUtils-8WtPGj6h.js"])))=>i.map(i=>d[i]);
import{_ as D}from"./preload-helper-B76NpbEU.js";import{j as pe,q as c,v as h,x as I,a6 as ai,bK as Je,aj as m,hQ as er,kV as tr,hR as ir,dd as mt,z as rn,bj as _t,V as Me,i as on,ed as nr,ad as Re,eb as Ze,c9 as rr,iu as or,bM as sr,ar as Te,br as ar,ec as lr,dF as pr,hi as cr,g3 as ur,fM as hr,al as sn,an as dr,cJ as li,ag as yr,N as Vt,gz as fr,fC as gr,c_ as vr,fx as mr,j7 as _r,lQ as Er,k3 as an,ap as br,fi as wr,dw as Ai,eo as Tr,dx as Sr,lR as Or,lS as $r,af as Gi,M as rt,ae as Rr,n as jt,u as Li,lT as Mr,gS as Pr,lU as ie,dy as xi,s as Ar,ge as Ci,ca as Gr,fd as Di,g4 as Ue}from"./main-wjLrsw2z.js";import{h as Lr}from"./UpdatingHandles-CBdbeOF2.js";import{i as xr,O as Xt,Q as Cr,L as Dr,k as Nr,K as Ir}from"./projectionUtils-Ck7cBeJK.js";import kr from"./GraphicsLayer-BIwQhDbY.js";import{v as ln,l as Hr,f as Ur,m as Vr,x as pn,E as jr,j as Ce}from"./elevationInfoUtils-fe-wgjs7.js";import{e as Fr}from"./editableLayers-DQL1HwJR.js";import{f as Ni,_ as A,r as zr,c as qr,n as Ii,a as M}from"./utils-B9iQJ2Oh.js";import{a as Zr,n as Yr}from"./Cyclical-K-a9e6FI.js";import{m as pi,o as We,a as ve,l as ci}from"./quantityUtils-Beu5Bph5.js";import{L as Br,e as H,d as se,u as Wr,q as cn,j as Ie,p as Ae,l as Kr,B as Jr,_ as Qr,o as un,b as hn,E as ki,m as Xr}from"./vec2-ChnYg_BJ.js";import{n as B,_ as eo,r as yt,l as to}from"./vec2f64-Cgb6qxNH.js";import{H as $,s as Gt,o as z,v as ei,R as j,P as V,q as x,_ as Et,Z as ti,c as Lt,p as Ye,J as io,j as dn,A as no,u as ro,I as oo}from"./vec32-B2d58gwM.js";import{n as be,a as yn,e as Qe}from"./projectVectorToVector-53cNtlQ9.js";import{N as ii,q as xt,b as Ct,j as bt,y as fn,R as so,v as ao}from"./geodesicUtils-mJFIZ9e0.js";import{d as lo}from"./asyncUtils-BI9hixG5.js";import{g as po}from"./TimeExtent-DunUFTD-.js";import{R as co}from"./Query-KleKJW6A.js";import{s as uo,j as ho}from"./vec42-CKs01hkn.js";import{n as yo}from"./vec4f64-DPb6J-GU.js";import{l as Dt,M as W,Q as ni,a as gn,k as vn,z as fo,p as mn,V as go,H as _n,O as ui,D as vo,J as mo}from"./plane-C3iMene6.js";import{I as _o,O as Eo,_ as bo,$ as wo,U as To}from"./sphere-DJFCFUk1.js";import{e as Ke}from"./common-DQOJ18NT.js";import{m as So,l as En}from"./geodeticLengthOperator-C9mpMpzD.js";import{e as Oo}from"./earcut-D9gy186-.js";import{v as $o}from"./triangle-CrBjRSOr.js";import{w as Ro,a as Mo}from"./spatialReferenceEllipsoidUtils-CYJizbww.js";let Le=class extends pe{constructor(e){super(e),this.length=null,this.verticalLength=null,this.area=null}};c([h()],Le.prototype,"length",void 0),c([h()],Le.prototype,"verticalLength",void 0),c([h()],Le.prototype,"area",void 0),Le=c([I("esri.views.interactive.sketch.Units")],Le);const wt=Le;var U;function Po(t,e){if(t==null||e==null)return;const i=ri(t,e);return i!=null?We(i,"radians","geographic"):void 0}(function(t){t.Absolute="absolute",t.Relative="relative",t.RelativeBilateral="relative-bilateral"})(U||(U={}));const ri=(()=>{const t=m(),e=m();return(i,n)=>(z(t,i.x,i.y,i.z??0),z(e,n.x,n.y,n.z??0),Ao(t,e,i.spatialReference,n.spatialReference))})(),Ao=(()=>{const t=B(),e=m(),i=m();return(n,r,o,a)=>{if($(n,r))return;const s=ii(o),p=ii(a);if(s&&p&&Je(s,p)&&be(n,o,e,s)&&be(r,a,i,p)){const{azimuth:u}=xt(Lo,e,i,s);return u!=null?ai(u,"degrees","radians"):void 0}t[0]=r[0]-n[0],t[1]=r[1]-n[1];let l=Br(eo,t);return t[0]<0&&(l=xo-l),l}})();function Ja(t,e,i,n=U.Absolute){if(e&&i)switch(n){case U.Absolute:return Po(e,i);case U.Relative:return Ui(Hi(t,e,i),U.Relative);case U.RelativeBilateral:return Ui(Hi(t,e,i),U.RelativeBilateral)}}function Hi(t,e,i){if(!t||!e||!i)return;const n=ri(t,e),r=ri(e,i);return n!=null&&r!=null?We(r-n,"radians","geographic"):void 0}function Ui(t,e){if(t!=null)switch(e){case U.Absolute:return Go(t);case U.Relative:{const i=Tt(t);let n=Vi.normalize(i,0,!0);return n===-180&&(n=180),We(n,"degrees","geographic")}case U.RelativeBilateral:{const i=Tt(t),n=Math.abs(Vi.normalize(i,0,!0));return We(n,"degrees","geographic")}}}function Go(t){const e=Tt(t),i=Co.normalize(e,0,!0);return We(i,"degrees","geographic")}const Qa=(()=>{const t=m();return(e,i,n,r,o,a="geodesic")=>{Gt(t,i);const s=Tt(o);if(a==="geodesic"){const y=ii(n);if(y&&be(t,n,t,y))return bt(e,t,s,r,y),e[2]=i[2],!!be(e,y,e,n)}const p=pi(s,"geographic","arithmetic"),l=ai(p,"degrees","radians"),u=i[0]+r*Math.cos(l),d=i[1]+r*Math.sin(l),v=i[2];return z(e,u,d,v),!0}})();function Tt(t){if(t!=null)return pi(bn(t),t.rotationType,"geographic")}function Xa(t){if(t!=null)return pi(bn(t),t.rotationType,"arithmetic")}function bn(t){return ai(t.value,t.unit,"degrees")}const Lo=new Ct,xo=2*Math.PI,Co=Zr,Vi=new Yr(-180,180);let _e=class extends pe{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?U.RelativeBilateral:U.Relative;case"absolute":return U.Absolute}}get displayUnits(){return this._get("displayUnits")??new wt}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new wt}set inputUnits(e){this._set("inputUnits",e)}};c([h({type:String,nonNullable:!0})],_e.prototype,"directionMode",void 0),c([h({type:Boolean,nonNullable:!0})],_e.prototype,"relativeDirectionIsBilateral",void 0),c([h()],_e.prototype,"effectiveDirectionMode",null),c([h({type:wt,nonNullable:!0})],_e.prototype,"displayUnits",null),c([h({type:wt,nonNullable:!0})],_e.prototype,"inputUnits",null),_e=c([I("esri.views.interactive.sketch.SketchValueOptions")],_e);const hi=_e;function ji(t){switch(t){case b.SUPPORTED:break;case b.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case b.GEOMETRY_MISSING:return"no geometry";case b.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case b.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case b.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}var b;(function(t){t[t.SUPPORTED=0]="SUPPORTED",t[t.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",t[t.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",t[t.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",t[t.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",t[t.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"})(b||(b={}));function Do(t){if(t.graphic&&t.graphic.layer?.type!=="graphics")return b.GRAPHICS_LAYER_MISSING;const e=t.operations?.data.type;if(!e)return b.GEOMETRY_TYPE_UNSUPPORTED;switch(e){case"polygon":case"point":case"polyline":case"mesh":break;default:return b.GEOMETRY_TYPE_UNSUPPORTED}const i=t.elevationInfo;return ln(i)?b.ELEVATION_MODE_UNSUPPORTED:b.SUPPORTED}function No(t){return Io(t).result}function Io(t){if(t.graphic&&t.graphic.layer?.type!=="graphics")return{result:b.GRAPHICS_LAYER_MISSING};if(!t.operations)return{result:b.GEOMETRY_MISSING};if(ln(t.elevationInfo))return{result:b.ELEVATION_MODE_UNSUPPORTED};const e=t.operations.data.type,i=t.operations.data.geometry;return e==="point"||e==="mesh"||e==="polyline"||e==="polygon"?{result:b.SUPPORTED,geometry:i}:{result:b.GEOMETRY_TYPE_UNSUPPORTED}}function ko(t){if(t.layer?.type!=="graphics")return b.GRAPHICS_LAYER_MISSING;if(t.geometry==null)return b.GEOMETRY_MISSING;switch(t.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return b.SUPPORTED;default:return b.GEOMETRY_TYPE_UNSUPPORTED}const e=t.symbol!=null&&t.symbol.type==="point-3d"&&t.symbol.symbolLayers;return!e||!e.some(i=>i.type==="object")?b.SYMBOL_TYPE_UNSUPPORTED:Hr(t)!=="on-the-ground"&&Ur(t)?b.ELEVATION_MODE_UNSUPPORTED:b.SUPPORTED}function Fi(t,e,i){if(!e||!t?.map)return;const{map:n}=t;n.layers.find(o=>o===e)||n.add(e,i)}function tl(t,e){const i=e?.type==="subtype-sublayer"?e.parent:e;return t.allLayerViews.find(n=>{const r=n.layer;return r===i||"sublayers"in r&&r.sublayers!=null&&r.sublayers.includes(i)})}function il(t){return Fr(t)||er(t)||tr(t)||ir(t)}let ft=class extends pe{constructor(e){super(e),this.enabled=!1}};c([h({type:Boolean,nonNullable:!0})],ft.prototype,"enabled",void 0),ft=c([I("esri.views.interactive.sketch.SketchLabelOptions")],ft);const di=ft;let Be=class extends pe{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};c([h({type:String,nonNullable:!0})],Be.prototype,"mode",void 0),Be=c([I("esri.views.interactive.sketch.SketchTooltipElevationOptions")],Be);let C=class extends pe{constructor(e){super(e),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};c([h({type:Boolean,nonNullable:!0})],C.prototype,"area",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"coordinates",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"direction",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"distance",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"elevation",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"header",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"helpMessage",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"orientation",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"radius",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"rotation",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"scale",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"size",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"totalLength",void 0),C=c([I("esri.views.interactive.sketch.SketchTooltipVisibleElements")],C);const wn=C;let k=class extends pe{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new Be,this.placement="auto",this.offset=null,this.visibleElements=new wn,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};c([h({type:Boolean,nonNullable:!0})],k.prototype,"enabled",void 0),c([h()],k.prototype,"forceEnabled",void 0),c([h()],k.prototype,"effectiveEnabled",null),c([h()],k.prototype,"helpMessage",void 0),c([h()],k.prototype,"helpMessageIcon",void 0),c([h({type:Boolean,nonNullable:!0})],k.prototype,"inputEnabled",void 0),c([h({type:Be,nonNullable:!0})],k.prototype,"elevation",void 0),c([h()],k.prototype,"placement",void 0),c([h()],k.prototype,"offset",void 0),c([h({type:wn,nonNullable:!0})],k.prototype,"visibleElements",void 0),c([h()],k.prototype,"visualVariables",void 0),c([h()],k.prototype,"xyMode",void 0),k=c([I("esri.views.interactive.sketch.SketchTooltipOptions")],k);const yi=k;let xe=class extends pe{constructor(e){super(e),this.labels=new di,this.tooltips=new yi,this.values=new hi}};c([h({nonNullable:!0,type:di})],xe.prototype,"labels",void 0),c([h({nonNullable:!0,type:yi})],xe.prototype,"tooltips",void 0),c([h({nonNullable:!0,type:hi})],xe.prototype,"values",void 0),xe=c([I("esri.views.interactive.sketch.SketchOptions")],xe);const Tn=xe;var Ge;function Sn(t,e,i){return q(t,e,i)}function q(t=0,e=0,i=0){return mt(t,e,i)}function ll(t){return t}function pl(t){return t}function Se(t,e,i){return mt(t,e,i)}function De(t){const[e,i,n]=t;return t.length>3?[e,i,n,t[3]]:[e,i,n]}function Ft(t){return t[3]=((t.length>3?t[3]:void 0)??Ge.NONE)|Ge.TARGET,t}function cl(t){return!!(((t.length>3?t[3]:void 0)??Ge.NONE)&Ge.TARGET)}function zi(t,e,{coordinateHelper:i,elevationInfo:n},r){return t?qe(i.vectorToDehydratedPoint(t,Ho),e,n,r):null}function qe(t,e,i,n=q()){return n[0]=t.x,n[1]=t.y,n[2]=t.z??0,e==null||(e.type==="2d"?n[2]=0:n[2]=Vr(e,t,i,Ce)??0),n}function ul(t,e,i){return i?(yn(i,t[0],t[1],t[2],e),i):Qe(t[0],t[1],t[2],e)}function qi(t,e,{z:i,m:n},r,o){const{spatialReference:a,elevationInfo:s}=r;let p;i==null&&n==null?p=void 0:e==null||e.type==="2d"?p=i??void 0:p=pn(e,t,a,Ce,s)??0;const[l,u]=t;return o?yn(o,l,u,p,a):o=Qe(l,u,p,a),n!=null&&(o.m=n,o.hasM=!0),o}function hl(t,e,i,n,r=q()){const[o,a]=t;return r[0]=o,r[1]=a,t.length>3&&(r[3]=t[3]??Ge.NONE),i?.type!=="3d"?(r[2]=e.value,r):(r[2]=jr(i,o,a,e.value,n,e.elevationInfo,Ce)??0,r)}(function(t){t[t.NONE=0]="NONE",t[t.TARGET=1]="TARGET"})(Ge||(Ge={}));const Ho=Qe(0,0,0,null);let ee=class extends rn{constructor(){super(...arguments),this.enabled=!0}};c([h({type:Boolean})],ee.prototype,"enabled",void 0),ee=c([I("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],ee);let T=class extends rn{constructor(e){super(e),this.lineSnapper=new ee,this.parallelLineSnapper=new ee,this.rightAngleSnapper=new ee,this.rightAngleTriangleSnapper=new ee,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new _t([255,127,0]),this.orangeTransparent=new _t([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};c([h({type:ee,constructOnly:!0,nonNullable:!0,json:{write:!0}})],T.prototype,"lineSnapper",void 0),c([h({type:ee,constructOnly:!0,nonNullable:!0,json:{write:!0}})],T.prototype,"parallelLineSnapper",void 0),c([h({type:ee,constructOnly:!0,nonNullable:!0,json:{write:!0}})],T.prototype,"rightAngleSnapper",void 0),c([h({type:ee,constructOnly:!0,nonNullable:!0,json:{write:!0}})],T.prototype,"rightAngleTriangleSnapper",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],T.prototype,"shortLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],T.prototype,"distance",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],T.prototype,"pointThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],T.prototype,"intersectionParallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],T.prototype,"parallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],T.prototype,"verticalLineThresholdMeters",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],T.prototype,"touchSensitivityMultiplier",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],T.prototype,"pointOnLineThreshold",void 0),c([h({type:_t,nonNullable:!0})],T.prototype,"orange",void 0),c([h({type:_t,nonNullable:!0})],T.prototype,"orangeTransparent",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],T.prototype,"lineHintWidthReference",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],T.prototype,"lineHintWidthTarget",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],T.prototype,"lineHintFadedExtensions",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],T.prototype,"parallelLineHintWidth",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],T.prototype,"parallelLineHintLength",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],T.prototype,"parallelLineHintOffset",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],T.prototype,"rightAngleHintSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],T.prototype,"rightAngleHintOutlineSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],T.prototype,"satisfiesConstraintScreenThreshold",void 0),T=c([I("esri.views.interactive.snapping.Settings.Defaults")],T);const St=new T;var N;(function(t){t[t.FEATURE=1]="FEATURE",t[t.SELF=2]="SELF",t[t.ALL=3]="ALL"})(N||(N={}));let ye=class extends pe{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new Me}};c([h({constructOnly:!0})],ye.prototype,"layer",void 0),c([h()],ye.prototype,"enabled",void 0),c([h()],ye.prototype,"updating",void 0),c([h()],ye.prototype,"availability",void 0),c([h()],ye.prototype,"sublayerSources",void 0),ye=c([I("esri.views.interactive.snapping.FeatureSnappingLayerSource")],ye);let G=class extends pe{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new Me,this.distance=St.distance,this.touchSensitivityMultiplier=St.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const e=this.featureSources;e.some(Zi)&&on.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const i=e.filter(Vo),n=this._get("_effectiveFeatureSources")?.filter(Zi)??new Me;for(const p of i){const l=n.find(u=>u.layer===p.layer.parent);if(l)l.sublayerSources.includes(p)||l.sublayerSources.add(p);else if(p.layer.parent){const u=new ye({layer:p.layer.parent});u.sublayerSources.add(p),n.add(u)}}for(const p of n){const l=p.sublayerSources.filter(u=>!i.includes(u));p.sublayerSources.removeMany(l)}n.removeMany(n.filter(p=>p.sublayerSources.length===0));const r=e.filter(Uo),o=this._get("_effectiveFeatureSources")??new Me,{added:a,removed:s}=nr(o.toArray(),[...r,...n]);return o.removeMany(s),o.addMany(a),o}};function Zi(t){return t.layer.type==="subtype-group"}function Uo(t){return t.layer.type!=="subtype-group"}function Vo(t){return t.layer.type==="subtype-sublayer"}c([h()],G.prototype,"enabled",void 0),c([h()],G.prototype,"enabledToggled",void 0),c([h()],G.prototype,"forceDisabled",void 0),c([h()],G.prototype,"selfEnabled",void 0),c([h()],G.prototype,"featureEnabled",void 0),c([h()],G.prototype,"gridEnabled",void 0),c([h()],G.prototype,"attributeRulesEnabled",void 0),c([h({type:Me.ofType(ye)})],G.prototype,"featureSources",void 0),c([h()],G.prototype,"distance",void 0),c([h()],G.prototype,"touchSensitivityMultiplier",void 0),c([h({readOnly:!0})],G.prototype,"effectiveEnabled",null),c([h({readOnly:!0})],G.prototype,"effectiveGridEnabled",null),c([h({readOnly:!0})],G.prototype,"effectiveSelfEnabled",null),c([h({readOnly:!0})],G.prototype,"effectiveFeatureEnabled",null),c([h({readOnly:!0})],G.prototype,"_effectiveFeatureSources",null),G=c([I("esri.views.interactive.snapping.SnappingOptions")],G);const vl=Symbol("grid-placement-graphic");function On(t,e){const i=t.x-e.x,n=t.y-e.y;return i*i+n*n}function ml(t,e){return Math.sqrt(On(t,e))}function jo(t,e){e.sort((i,n)=>ei(i.targetPoint,t)-ei(n.targetPoint,t))}var K;function _l({parameters:{point:t,distance:e,returnEdge:i,vertexMode:n,coordinateHelper:{spatialReference:r},filter:o},mode:a,returnZ:s,filter:p}){const l=p?.clone()??new co({where:"1=1"});return l.returnZ=s??a==="3d",o&&(l.geometry=o.geometry,l.distance=o.distance,l.spatialRelationship=o.spatialRelationship,l.where=rr(l.where,o.where),l.timeExtent=po(l.timeExtent,o.timeExtent),l.objectIds=Fo(l.objectIds,o.objectIds)),{point:Qe(t[0],t[1],t[2],r.toJSON()),mode:a,distance:e,returnEdge:i,vertexMode:n,query:l.toJSON()}}function Fo(t,e){return t||e?e?t?Array.from(or(new Set(t),new Set(e))):e:t:null}function El(t,e,i){return{left:zi(t.leftVertex.pos,e,i),right:zi(t.rightVertex.pos,e,i)}}(function(t){t[t.TARGET=0]="TARGET",t[t.REFERENCE=1]="REFERENCE",t[t.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(K||(K={}));const Yi=Symbol("snapping-toggle");function zo(t,e=()=>{}){const i=Re(()=>({view:t.view,snappingOptions:t.snappingOptions}),({view:n,snappingOptions:r})=>{if(t.removeHandles(Yi),!n||!r)return;const o=A.TOOL,a=[n.on("key-down",s=>{s.key!==Ni.toggle||s.repeat||(r.enabledToggled=!0,e())},o),n.on("key-up",s=>{s.key===Ni.toggle&&(r.enabledToggled=!1,e())},o),n.on("pointer-move",s=>{const p=s.native.ctrlKey;r.enabledToggled!==p&&(r.enabledToggled=p,e())},o)];t.addHandles(a,Yi)},Ze);t.addHandles(i)}function bl(t){return zr(t)&&"utilityNetworks"in t&&!!t.utilityNetworks?.length}function zt(t,e){return t[0]*e[1]-t[1]*e[0]}function qo(t,e,i){const n=Ie(i,e)/Ae(i);return Kr(t,i,n)}function wl(t,e,i,n,r=i){return H(Pe,n,i),H(Ot,e,r),qo(Ne,Ot,Pe),Wr(t,r,Ne)}function Tl(t,e,i,n){H(Pe,e,i);const r=n/cn(Pe);return se(t,i,Pe,r)}function Sl(t,e){const i=t.start,n=t.end,r=e.start,o=e.end,a=H(Pe,n,i),s=H($n,o,r),p=zt(a,s);if(Math.abs(p)<=Yo)return[];const l=H(Ot,i,r),u=zt(s,l)/p,d=zt(a,l)/p;if(u>=0){if(d>=0||e.type===R.LINE)return[se(Ne,i,a,u)]}else if(t.type===R.LINE&&(d>=0||e.type===R.LINE))return[se(Ne,i,a,u)];return[]}function Zo(t,e,i){const n=[],r=H(Pe,t.end,t.start),o=H($n,t.start,e),a=Ae(r),s=2*Ie(r,o),p=s*s-4*a*(Ae(o)-i*i);if(p===0){const l=-s/(2*a);(t.type===R.LINE||l>=0)&&n.push(se(Ne,t.start,r,l))}else if(p>0){const l=Math.sqrt(p),u=(-s+l)/(2*a);(t.type===R.LINE||u>=0)&&n.push(se(Ne,t.start,r,u));const d=(-s-l)/(2*a);(t.type===R.LINE||d>=0)&&n.push(se(Ot,t.start,r,d))}return n}var R;(function(t){t[t.RAY=0]="RAY",t[t.LINE=1]="LINE"})(R||(R={}));const Yo=1e-6,Pe=B(),$n=B(),Ot=B(),Ne=B();function fi({start:t,end:e,type:i},n,r){const o=[],a=H(Xe,e,t),s=H(Nt,t,n),p=Ae(a),l=2*Ie(a,s),u=l*l-4*p*(Ae(s)-r*r);if(u===0){const d=-l/(2*p);(i===F.PLANE||d>=0)&&o.push(se(B(),t,a,d))}else if(u>0){const d=Math.sqrt(u),v=(-l+d)/(2*p);(i===F.PLANE||v>=0)&&o.push(se(B(),t,a,v));const y=(-l-d)/(2*p);(i===F.PLANE||y>=0)&&o.push(se(B(),t,a,y))}return o}function Rn(t,e){const i=t.start,n=t.end,r=H(Xe,n,i),o=z(kt,-r[1],r[0],0),a=e.start,s=e.end,p=j(vi,s,a),l=V(p,o),u=z(Dn,i[0],i[1],0),d=j(Nn,u,a),v=V(d,o),y=Ke();if(Math.abs(l)<y)return[];const f=x(In,a,p,v/l);if(e.type===R.RAY){const g=j(oi,f,a);if(V(g,p)<-y)return[]}if(t.type===F.HALF_PLANE){const g=Jr(Nt,f,i);if(Ie(g,r)<-y)return[]}return[Te(f)]}function Bo(t,e){return Ko($t(mi,e[2],t),e)}function Mn(t,e){return xn($t(mi,0,t),$t(es,0,e)).map(([n,r])=>yt(n,r))}function Pn(t,e,i){return Gn(t,$t(mi,t[2],e),i)}function An(t,e,i,n=m()){const r=H(Xe,t,e),o=cn(r);return se(n,e,r,o===0?1:i/o),n[2]=t[2],n}function Gn(t,{start:e,end:i,type:n},r=m()){const o=j(It,t,e),a=j(kt,i,e),s=V(o,a)/V(a,a);return x(r,e,a,n===R.RAY?Math.max(s,0):s)}const Wo=(()=>{const t=m(),e=m(),i=m();return({start:n,end:r},{center:o,radius:a,normal:s,slicePlane:p})=>{const l=Dt(o,s,Xo);if(w(ni(l,n),0)&&w(ni(l,r),0)){gn(s,t,e);const d=(f,g)=>(Lt(i,g,o),un(f,V(i,t),V(i,e)),f),v=Zo({start:d(Xe,n),end:d(Nt,r),type:R.LINE},to,a),y=[];for(const[f,g]of v){const _=Gt(m(),o);x(_,_,t,f),x(_,_,e,g),p&&!we(p,_)||y.push(_)}return y}const u=m();return vn(l,n,r,u)?!w(Ye(u,o),a)||p&&!we(p,u)?[]:[u]:[]}})();function Ln({start:t,end:e,type:i},n,r){const o=[],a=Lt(It,e,t),s=H(Nt,t,n),p=Ae(a),l=2*Ie(a,s),u=l*l-4*p*(Ae(s)-r*r);if(u===0){const d=-l/(2*p);(i===R.LINE||d>=0)&&o.push(x(m(),t,a,d))}else if(u>0){const d=Math.sqrt(u),v=(-l+d)/(2*p);(i===R.LINE||v>=0)&&o.push(x(m(),t,a,v));const y=(-l-d)/(2*p);(i===R.LINE||y>=0)&&o.push(x(m(),t,a,y))}return o}function xn(t,e){const i=t.start,n=t.end,r=e.start,o=e.end,a=j(It,n,i),s=j(kt,o,r),p=j(vi,r,i),l=Et(Dn,a,s);if(!w(V(p,l),0))return[];const u=ti(l);if(w(u,0))return[];const d=Et(Nn,p,s),v=V(d,l)/u,y=x(In,i,a,v);if(t.type===R.RAY){const f=j(oi,y,i);if(V(a,f)<-Ke())return[]}if(e.type===R.RAY){const f=j(oi,y,r);if(V(s,f)<-Ke())return[]}return[Te(y)]}function Ko({start:t,end:e,type:i},n){const r=j(It,n,t),o=j(kt,e,t),a=Et(vi,o,r),s=ti(a)/ti(o),p=Ke();if(s<p)switch(i){case R.LINE:return[Te(n)];case R.RAY:return V(o,r)<-p?[]:[Te(n)]}return[]}function gi(t,e,i,n){const[r,o]=t,[a,s]=i,p=a-r,l=s-o,u=p*p+l*l,d=Math.sqrt(u);if(d>e+n)return[];if(d<Math.abs(e-n))return[];if(w(d,0)&&w(e,n))return[];const v=(e*e-n*n+u)/(2*d),y=Math.sqrt(e*e-v*v),f=y*l/d,g=y*p/d,[_,O]=Qr(Xe,t,i,v/d);return w(f,g)?[yt(_,O)]:[yt(_+f,O-g),yt(_-f,O+g)]}function $t(t,e,{start:i,end:n,type:r}){return z(t.start,i[0],i[1],e),z(t.end,n[0],n[1],e),t.type=Qo[r],t}function Cn(t,e){return w(t[2],e[2])}function w(t,e){return sr(Math.abs(t-e),0,Ke())}function Jo(t,e){return e.filter(i=>we(t,i))}function we(t,e){return fo(t,e)}var F;(function(t){t[t.PLANE=0]="PLANE",t[t.HALF_PLANE=1]="HALF_PLANE"})(F||(F={}));const Qo={[F.PLANE]:R.LINE,[F.HALF_PLANE]:R.RAY},Xe=B(),Nt=B(),It=m(),kt=m(),vi=m(),Dn=m(),Nn=m(),In=m(),oi=m(),Xo=W(),mi={start:m(),end:m(),type:R.LINE},es={start:m(),end:m(),type:R.LINE};class J{intersect(e){return ce(this,e)}closestPoints(e){return[this.closestTo(e)]}}class ke extends J{constructor(e){super(),this.point=e}equals(e){return this===e||Q(e)&&$(this.point,e.point)}closestTo(){return De(this.point)}}class _i extends J{constructor(e,i,n){super(),this.start=e,this.end=i,this.lineLike={start:e,end:i,type:n}}equals(e){return this===e||ne(e)&&this.lineLike.type===e.lineLike.type&&$(this.start,e.start)&&$(this.end,e.end)}closestTo(e){const i=q();return Gn(e,this.lineLike,i),i}}class Ei extends _i{constructor(e,i){super(e,i,R.LINE)}}class ts extends _i{constructor(e,i){super(e,i,R.RAY)}}class kn extends J{constructor(e){super(),this.constraints=e}equals(e){return this===e||si(e)&&lr(this.constraints,e.constraints,(i,n)=>i.equals(n))}closestTo(e){let i,n=1/0;for(const r of this.constraints){const o=r.closestTo(e),a=ei(e,o);a<n&&(n=a,i=o)}return De(i??e)}closestPoints(e){return this.constraints.flatMap(i=>i===this?[]:i.closestPoints(e))}}class Hn extends J{constructor(e,i){super(),this.center=e,this.radius=i}equals(e){return this===e||oe(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const i=q();return An(e,this.center,this.radius,i),i}}class bi extends J{constructor(e,i){super(),this.center=e,this.radius=i}equals(e){return this===e||he(e)&&$(this.center,e.center)&&this.radius===e.radius}closestTo(e){const i=q();return An(e,this.center,this.radius,i),i[2]=this.center[2],i}asCircle(){return new wi(De(this.center),this.radius,Se(0,0,1))}}class wi extends J{constructor(e,i,n,r=void 0){super(),this.center=e,this.radius=i,this.normal=n,this.slicePlane=r}equals(e){return this===e||Ee(e)&&$(this.center,e.center)&&$(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:i,radius:n}=this;_n(this.getPlane(is),e,qt);const r=j(qt,qt,i),o=dn(r);if(w(o,0))return De(e);const a=n/Math.sqrt(o),s=q();x(s,i,r,a);const{slicePlane:p}=this;return p&&!we(p,s)?Si(p,this)?.closestTo(e)??De(e):s}getPlane(e=W()){return Dt(this.center,this.normal,e)}}const qt=m(),is=W();class ns extends J{constructor(e){super(),this.z=e}equals(e){return this===e||ue(e)&&this.z===e.z}closestTo(e){return Se(e[0],e[1],this.z)}getPlane(e=W()){return z(Bi,0,0,this.z),Dt(Bi,pr,e)}}const Bi=m();class Ti extends J{constructor(e,i,n){super(),this.start=e,this.end=i,this.planeLike={start:e,end:i,type:n}}equals(e){return this===e||re(e)&&this.planeLike.type===e.planeLike.type&&$(this.start,e.start)&&$(this.end,e.end)}closestTo(e){const i=q();return Pn(e,this.planeLike,i),i}closestEndTo(e){const{start:i,end:n}=this.planeLike;return Math.sign(Ie(H(rs,n,i),H(os,e,i)))>0?this.end:this.start}getPlane(e=W()){const i=Gt(Wi,this.end);return i[2]+=1,mn(this.start,this.end,i,e)}getSlicePlane(e=W()){const{start:i,end:n,type:r}=this.planeLike;if(r===F.PLANE)return;const o=z(Wi,i[0],i[1],0),a=z(Ki,n[0],n[1],0),s=Lt(Ki,a,o);return Dt(o,s,e),e}}const rs=B(),os=B(),Wi=m(),Ki=m();class Ol extends Ti{constructor(e,i){super(e,i,F.HALF_PLANE)}}class Un extends Ti{constructor(e,i){super(e,i,F.PLANE)}}class ss extends J{constructor(e,i){super(),this.sphere=Eo(e,i)}equals(e){return this===e||de(e)&&bo(this.sphere,e.sphere)}closestTo(e){const i=q();return wo(this.sphere,e,i),i}get center(){return To(this.sphere)}get radius(){return this.sphere[3]}}class Vn extends J{constructor(e,i,n){super(),this.start=e,this.end=i,this.getZ=n,this.planeLike={start:e,end:i,type:F.PLANE}}equals(e){return this===e||Rt(e)&&$(this.start,e.start)&&$(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return hs(this,e)}addIfOnTheGround(e,i){for(const n of i){const r=this.getZ(n[0],n[1])??0;w(n[2],r)&&(n[2]=r,e.push(n))}}}class as extends J{constructor(e,i,n){super(),this._x=e,this._y=i,this._z=n}equals(e){return this===e||Ms(e)&&this._x===e._x&&this._y===e._y&&this._z===e._z}closestTo([e,i,n]){return Sn(this._x??e,this._y??i,this._z??n)}}class ls extends J{constructor(e,i,n,r,o){super(),this._origin=e,this._spatialReference=i,this._distanceMeters=n,this._z=r,this._directionDegrees=o}equals(e){return this===e||Rs(e)&&ki(this._origin,e._origin)&&this._spatialReference===e._spatialReference&&this._distanceMeters===e._distanceMeters&&this._z===e._z&&this._directionDegrees===e._directionDegrees}closestTo([e,i,n]){return un(Ve,e,i),ki(Ve,this._origin)||this._applyDirectionAndDistance(Ve),Sn(Ve[0],Ve[1],this._z??n)}_applyDirectionAndDistance(e){if(this._directionDegrees!=null&&this._distanceMeters!=null)bt(e,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)cs(e,this._origin,this._directionDegrees,e,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:i}=xt(ps,this._origin,e,this._spatialReference);bt(e,this._origin,i??0,this._distanceMeters,this._spatialReference)}}}const Ve=[0,0],ps=new Ct;function cs(t,e,i,n,r){let{azimuth:o,distance:a}=xt(us,e,n,r);o??=0;let s=a*Math.cos((o-i)*xr);s=Math.max(0,s),bt(t,e,i,s,r)}const us=new Ct;function hs(t,e){const i=q();return Pn(e,t.planeLike,i),i[2]=t.getZ(i[0],i[1])??Fn,i}function ce(t,e){if(si(t)){const i=[];for(const n of t.constraints){const r=n.intersect(e);r&&i.push(r)}return Oi(i)}if(si(e))return ce(e,t);if(Rt(t))return Ji(t,e);if(Rt(e))return Ji(e,t);if(Q(t)){const{point:i}=t;if(Q(e))return $(i,e.point)?t:void 0;const n=e.closestTo(i);return io(n,i)?t:void 0}if(ne(t)){if(Q(e))return ce(e,t);if(ne(e))return te(xn(t.lineLike,e.lineLike));if(ue(e))return ds(t,e);if(re(e))return te(Rn(e.planeLike,t.lineLike));if(oe(e))return te(Ln(t.lineLike,e.center,e.radius));if(Ee(e))return te(Wo(t.lineLike,e));if(he(e))return ys(t,e);if(de(e))return fs(t,e)}else if(ue(t)){if(Q(e)||ne(e))return ce(e,t);if(ue(e))return gs(t,e);if(re(e))return vs(t,e);if(oe(e))return ms(t,e);if(Ee(e))return Es(t,e);if(he(e))return _s(t,e);if(de(e))return bs(t,e)}else if(re(t)){if(Q(e)||ne(e)||ue(e))return ce(e,t);if(re(e))return Zt(Mn(t.planeLike,e.planeLike));if(oe(e))return Zt(fi(t.planeLike,e.center,e.radius));if(Ee(e))return Ts(t,e);if(he(e))return ws(t,e);if(de(e))return Ss(t,e)}else if(oe(t)){if(Q(e)||ne(e)||ue(e)||re(e))return ce(e,t);if(oe(e))return Zt(gi(t.center,t.radius,e.center,e.radius));if(Ee(e))return void 0;if(he(e))return Os(t,e);if(de(e))return void 0}else if(Ee(t)){if(Q(e)||ne(e)||ue(e)||re(e)||oe(e))return ce(e,t);if(Ee(e))return void 0;if(he(e))return e.asCircle(),void 0;if(de(e))return void 0}else if(he(t)){if(Q(e)||ne(e)||ue(e)||re(e)||oe(e)||Ee(e))return ce(e,t);if(he(e))return $s(e,t);if(de(e))return void 0}else if(de(t)){if(Q(e)||ne(e)||ue(e)||re(e)||oe(e)||he(e))return ce(e,t);if(de(e))return void 0}}const ds=(()=>{const t=W();return(e,i)=>{const{start:n,end:r}=e;if(Cn(n,r)&&w(n[2],i.z))return e;const o=q();return vn(i.getPlane(t),n,r,o)?new ke(o):void 0}})();function ys({lineLike:t},{center:e,radius:i}){const n=e[2];return te(Ln(t,e,i).filter(r=>w(r[2],n)))}function fs({lineLike:t},{sphere:e}){return te(_o(e,t.start,t.end))}const Si=(()=>{const t=yo(),e=m(),i=m();return(n,r,o)=>{const{normal:a,center:s,radius:p}=r;gn(a,e,i);const l=ui(n),u=p*V(l,e),d=p*V(l,i);uo(t,s[0],s[1],s[2],1);const v=ho(n,t),y=Math.hypot(u,d),f=w(y,0);if(w(ni(n,s),0)){if(f)return r;if(w(p,0))return!o||we(o,s)?new ke(De(s)):void 0;Et(e,l,a),no(e,e);const Ut=new Array,it=Te(s);x(it,it,e,p),o&&!we(o,it)||Ut.push(it);const nt=Te(s);return x(nt,nt,e,-p),o&&!we(o,nt)||Ut.push(nt),te(Ut)}if(f)return;const g=-v/y;if(Math.abs(g)>1||w(g,1))return;const _=Math.atan(u/d),O=cr(g)-_,S=Math.PI-O,Oe=new Array,et=m();x(et,s,e,p*Math.cos(O)),x(et,et,i,p*Math.sin(O)),Oe.push(et);const tt=m();return x(tt,s,e,p*Math.cos(S)),x(tt,tt,i,p*Math.sin(S)),Oe.push(tt),te(o?Jo(o,Oe):Oe)}})();function gs(t,e){return w(t.z,e.z)?t:void 0}function vs({z:t},{planeLike:e}){const[i,n]=e.start,[r,o]=e.end,a=Se(i,n,t),s=Se(r,o,t);return e.type===F.PLANE?new Ei(a,s):new ts(a,s)}function ms(t,e){const[i,n]=e.center;return new bi(Se(i,n,t.z),e.radius)}function _s(t,e){return w(e.center[2],t.z)?e:void 0}const Es=(()=>{const t=W();return(e,i)=>Si(e.getPlane(t),i,i.slicePlane)})();function bs(t,{center:e,radius:i}){const n=Math.abs(e[2]-t.z);if(n>i&&!w(n,i))return;const r=Se(e[0],e[1],t.z),o=Math.sqrt(i**2-n**2);return w(o,0)?void 0:new bi(r,o)}const ws=(()=>{const t=W();return(e,{center:i,radius:n})=>{const r=fi(e.planeLike,i,n),o=i[2];e.getSlicePlane(t);const a=new Array;for(const[s,p]of r){const l=[s,p,o];we(t,l)&&a.push(l)}return te(a)}})(),Ts=(()=>{const t=W(),e=W();return(i,n)=>Si(i.getPlane(t),n,i.getSlicePlane(e))})(),Ss=(()=>{const t=W();return(e,{center:i,radius:n})=>{const r=e.getPlane(t),o=go(r,i),a=Math.abs(o);if(a>n&&!w(a,n))return;const s=Math.sqrt(n**2-o**2);if(w(s,0)){const u=q();return _n(r,i,u),new ke(u)}const p=q(),l=Te(ui(r));return x(p,i,l,o),new wi(p,s,l,e.getSlicePlane())}})();function Os(t,e){const i=hn(t.center,e.center);return w(i,0)&&w(t.radius,e.radius)?e:jn(gi(t.center,t.radius,e.center,e.radius),e.center[2])}function $s(t,e){if(!Cn(t.center,e.center))return;const i=hn(t.center,e.center);return w(i,0)&&w(t.radius,e.radius)?t:jn(gi(t.center,t.radius,e.center,e.radius),t.center[2])}function Ji(t,e){const{planeLike:i,getZ:n}=t,r=new Array;if(Q(e))t.addIfOnTheGround(r,Bo(i,e.point));else if(ne(e))t.addIfOnTheGround(r,Rn(i,e.lineLike));else if(oe(e))for(const[o,a]of fi(i,e.center,e.radius)){const s=n(o,a);s!=null&&r.push(mt(o,a,s))}else if(re(e)||Rt(e))for(const[o,a]of Mn(i,e.planeLike)){const s=n(o,a)??Fn;r.push(mt(o,a,s))}return te(r)}function Zt(t){return Oi(t.map(([e,i])=>{const n=Se(e,i,0),r=Se(e,i,1);return new Ei(n,r)}))}function te(t){return Oi(t.map(e=>e?new ke(e):void 0))}function jn(t,e){return te(t.map(([i,n])=>[i,n,e]))}function Oi(t){if(t.length!==0)return t.length===1?t[0]??void 0:new kn(t.filter(ar))}function si(t){return t instanceof kn}function Q(t){return t instanceof ke}function ne(t){return t instanceof _i}function ue(t){return t instanceof ns}function re(t){return t instanceof Ti}function oe(t){return t instanceof Hn}function he(t){return t instanceof bi}function Ee(t){return t instanceof wi}function de(t){return t instanceof ss}function Rt(t){return t instanceof Vn}function Rs(t){return t instanceof ls}function Ms(t){return t instanceof as}const Fn=0;let He=class{constructor(e,i,n,r){this.targetPoint=e,this.constraint=i,this.isDraped=n,this.domain=r}},zn=class extends He{constructor({targetPoint:e,objectId:i,constraint:n,isDraped:r}){super(e,n,r,N.FEATURE),this.objectId=i}},Ht=class{constructor(e,i){this.isDraped=e,this.domain=i}},le=class qn extends Ht{constructor(e,i,n,r,o=N.ALL,a=!0,s=!0){super(r,o),this.type=e,this.lineStart=i,this.lineEnd=n,this.fadeLeft=a,this.fadeRight=s}equals(e){return e instanceof qn&&this.type===e.type&&$(this.lineStart,e.lineStart)&&$(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return Ye(this.lineStart,this.lineEnd)}},Ps=class extends zn{constructor(e){super({...e,isDraped:!0,constraint:new Vn(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new le(K.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},As=class extends zn{constructor(e){super({...e,constraint:new Ei(e.edgeStart,e.edgeEnd)})}get hints(){return[new le(K.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Gs=class Zn extends Ht{constructor(e,i,n=N.ALL){super(i,n),this.intersectionPoint=e}equals(e){return e instanceof Zn&&$(this.intersectionPoint,e.intersectionPoint)}},gt=class extends He{constructor(e,i,n,r){super(e,new ke(e),r,N.ALL),this.first=i,this.second=n}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Gs(this.targetPoint,this.isDraped,this.domain)]}},Ls=class extends He{constructor({lineStart:e,lineEnd:i,targetPoint:n,isDraped:r}){super(n,new Un(e,i),r,N.SELF),this._referenceLineHint=new le(K.REFERENCE_EXTENSION,e,i,r,this.domain)}get hints(){return[this._referenceLineHint,new le(K.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},xs=class Yn extends Ht{constructor(e,i,n,r=N.ALL){super(n,r),this.lineStart=e,this.lineEnd=i}equals(e){return e instanceof Yn&&$(this.lineStart,e.lineStart)&&$(this.lineEnd,e.lineEnd)}},Cs=class extends He{constructor({referenceLine:e,lineStart:i,targetPoint:n,isDraped:r}){const o=Te(i),{left:a,right:s}=e;Lt(o,ro(o,o,s),a),super(n,new Un(i,o),r,N.SELF),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new le(K.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new xs(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new le(K.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const i={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(n=>{$(e.right,n.edge.left)&&(n.fadeLeft=!1,i.fadeRight=!1),$(e.right,n.edge.right)&&(n.fadeRight=!1,i.fadeRight=!1),$(e.left,n.edge.right)&&(n.fadeRight=!1,i.fadeLeft=!1),$(e.left,n.edge.left)&&(n.fadeLeft=!1,i.fadeLeft=!1)}),this._referenceLines.push(i)}},Bn=class Wn extends Ht{constructor(e,i,n,r,o=N.ALL){super(r,o),this.previousVertex=e,this.centerVertex=i,this.nextVertex=n}equals(e){return e instanceof Wn&&$(this.previousVertex,e.previousVertex)&&$(this.centerVertex,e.centerVertex)&&$(this.nextVertex,e.nextVertex)}},Ds=class extends He{constructor({targetPoint:e,constraint:i,previousVertex:n,otherVertex:r,otherVertexType:o,isDraped:a,selfSnappingType:s,objectId:p,domain:l}){super(e,i,a,l??N.SELF),this.previousVertex=n,this.otherVertex=r,this.otherVertexType=o,this.selfSnappingType=s??Pt.None,this.objectId=p??null}get hints(){const e=this.previousVertex,i=this.otherVertexType===Mt.CENTER?this.otherVertex:this.targetPoint,n=this.otherVertexType===Mt.CENTER?this.targetPoint:this.otherVertex;return[new le(K.TARGET,i,n,this.isDraped,this.domain),new le(K.REFERENCE,e,i,this.isDraped,this.domain),new Bn(this.previousVertex,i,n,this.isDraped,this.domain)]}};var Mt,Pt;(function(t){t[t.NEXT=0]="NEXT",t[t.CENTER=1]="CENTER"})(Mt||(Mt={})),function(t){t[t.None=0]="None",t[t.LastVertex=1]="LastVertex",t[t.FirstVertex=2]="FirstVertex",t[t.ExistingEdge=3]="ExistingEdge"}(Pt||(Pt={}));let Ns=class extends He{constructor({targetPoint:e,point1:i,point2:n,isDraped:r}){super(e,new Hn(oo(m(),i,n,.5),.5*Xr(i,n)),r,N.SELF),this._p1=i,this._p2=n}get hints(){return[new le(K.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new le(K.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new Bn(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}};function Is(t,e,i,n,r=m()){const o=Gt(ks,t);return o[2]=pn(n,o,e,i)||0,n.renderCoordsHelper.toRenderCoords(o,e,r),r}const ks=m();function Hs(t,e,i,n){return n.type==="2d"?(ot.x=t[0],ot.y=t[1],ot.spatialReference=e,n.toScreen(ot)):(Is(t,e,i,n,Qi),n.state.camera.projectToScreen(Qi,Yt),ur(Yt[0],Yt[1]))}const ot=Qe(0,0,0,null),Qi=m(),Yt=hr();function Nl(t){return fn(t)||sn(t)}function $i(t,e,i,...n){return fn(t)?e.apply(void 0,n):t.isWebMercator?i.apply(void 0,n):null}function Us(t){const{spatialReference:e}=t;return $i(e,qs,Zs,t)}function Vs(t,e){if(!Je(t.spatialReference,e.spatialReference))return null;const{spatialReference:i}=t;return st[0]=t.x,st[1]=t.y,st[2]=t.hasZ?t.z:0,at[0]=e.x,at[1]=e.y,at[2]=e.hasZ?e.z:0,Kn(st,at,i)}function Kn(t,e,i){return $i(i,Fs,zs,t,e,i)}const js={geodesicLength:Us,geodesicDistanceBetweenPoints:Vs,geodesicDistance:Kn};async function Jn(){return await So(),js}function Fs(t,e,i){return ve(xt(Bs,t,e,i).distance,"meters")}function zs(t,e,i){return ve(En(Ys(t,e,i),{unit:"meters"}),"meters")}function qs(t){return ve(so([t],"meters")[0],"meters")}function Zs(t){return ve(En(t,{unit:"meters"}),"meters")}function Ys(t,e,i){return new dr({spatialReference:i,paths:[[[...t],[...e]]]})}const Bs=new Ct,st=m(),at=m();let X=class extends li.EventedMixin(pe){constructor(e){super(e),this.options=new G,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=fe.MAIN}initialize(){this.addHandles([Re(()=>{const{distance:e,touchSensitivityMultiplier:i,effectiveSelfEnabled:n,effectiveFeatureEnabled:r,effectiveGridEnabled:o}=this.options;return{selfEnabled:n,featureEnabled:r,gridEnabled:this.view.type==="2d"&&o,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:i}},(e,i)=>{i&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=lo(n=>this._updateEngines(e,i,n))},Ze),Re(()=>this.options,e=>{for(const i of this._engines)i.options=e},yr)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,i,n){if(!e.viewReady)return void this._destroyEngines();i?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();const r=this._engineCache,o=await Promise.allSettled([e.featureEnabled&&!r.has("feature")?this._createFeatureSnappingEngine(n):void 0,e.selfEnabled&&!r.has("self")?this._createSelfSnappingEngine(n):void 0,e.gridEnabled&&!r.has("grid")?this._createGridSnappingEngine(n):void 0]);if(n.aborted)for(const a of o)a.status==="fulfilled"&&a.value?.engine.destroy();else{for(const a of o)a.status==="fulfilled"&&a.value&&r.set(a.value.type,a.value.engine);this._engines=Array.from(r.values())}}async _createSelfSnappingEngine(e){const[{SelfSnappingEngine:i},n]=await Promise.all([D(()=>import("./SelfSnappingEngine-DV9xbOJp.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51]),import.meta.url),Jn()]);return Vt(e),{type:"self",engine:new i({view:this.view,options:this.options,geodesicLengthMeasurementUtils:n})}}async _createGridSnappingEngine(e){const{view:i}=this;if(i.type!=="2d")return;const{GridSnappingEngine:n}=await D(()=>import("./GridSnappingEngine-dJmTPCkh.js"),__vite__mapDeps([52,1,2,3,12,10,14,53,54,55,56,57,58,32,13,15,16,17,18,19,20,21,22,23,24,25,7,8,6,26,27,28,29,4,5,9,11,30,31,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51]),import.meta.url);return Vt(e),{type:"grid",engine:new n({view:i,options:this.options})}}async _createFeatureSnappingEngine(e){const{FeatureSnappingEngine:i}=await D(()=>import("./FeatureSnappingEngine-DOykJF6S.js"),__vite__mapDeps([59,2,1,3,33,9,10,12,13,6,7,8,60,34,35,36,18,61,62,14,15,16,17,19,20,21,22,23,24,25,26,27,28,29,4,5,11,30,31,32,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51]),import.meta.url);Vt(e);const{view:n,options:r}=this,{spatialReference:o}=n;return{type:"feature",engine:new i({view:n,options:r,spatialReference:o})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:i}=this.options,n=e*i;return n*n}snap(e){return Js(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:i,context:n}=e;this._removeVisualization();const r=this._currentMainCandidate;if(r==null)return i;const o=this._selectUpdateInput(e);if(o==null)return i;const{spatialReference:a}=n,s=Xt(o,a);if(s==null)return i;const{view:p}=this,{elevationInfo:l,visualizer:u}=n,d=[],v=qe(s,p,l),y=r.constraint.closestTo(v);if(!this._arePointsWithinScreenThreshold(v,y,n)||!Wt(r,n.drawConstraints))return this._resetSnappingState(),i;r.targetPoint=Ft(y),d.push(...r.hints);for(const f of this._currentOtherActiveCandidates)Wt(f,n.drawConstraints)&&(f.targetPoint=Ft(y),d.push(...f.hints));return u!=null&&this.addHandles(u.draw(d,{spatialReference:a,elevationInfo:Qs(n),view:p,selfSnappingZ:n.selfSnappingZ}),Bt),qi(y,p,i,n)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:i}){switch(this._currentSnappedType){case fe.MAIN:return e;case fe.SCENE:return i}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=fe.MAIN}_removeVisualization(){this.removeHandles(Bt)}async _snapSinglePoint({point:e,context:i,signal:n}){const{view:r}=this,{elevationInfo:o}=i,a=qe(e,r,o),s=await this._fetchCandidates(a,N.ALL,i,n);return this._createSnapResult(a,fe.MAIN,s,r,e,i,n)}async _snapMultiPoint({point:e,scenePoint:i,context:n,signal:r}){const{view:o}=this,{coordinateHelper:a,elevationInfo:s,spatialReference:p}=n;await Cr(i.spatialReference,p);const l=Xt(i,p),u=qe(l,o,s),d=await this._fetchCandidates(u,N.FEATURE,n,r);if(d.length>0){const f=await this._fetchCandidates(u,N.SELF,n,r);return this._createSnapResult(u,fe.SCENE,[...d,...f],o,l,n,r)}const v=qe(e,o,s),y=await this._fetchCandidates(v,N.SELF,n,r);return this._createSnapResult(v,fe.MAIN,y,o,{z:a.hasZ()&&e.hasZ?e.z??0:void 0,m:a.hasM()&&e.hasM?e.m??0:void 0},n,r)}async _fetchCandidates(e,i,n,r){return(await Promise.all(this._engines.map(o=>o.fetchCandidates(e,i,n,r)))).flat()}_createSnapResult(e,i,n,r,o,a,s){return{get valid(){return!fr(s)},apply:()=>{const{spatialReference:p}=a,{snappedPoint:l,hints:u}=this._processCandidates(e,i,n,a);return this._removeVisualization(),a.visualizer!=null&&this.addHandles(a.visualizer.draw(u,{spatialReference:p,elevationInfo:Ce,view:r,selfSnappingZ:a.selfSnappingZ}),Bt),qi(l,r,o,a)}}}_processCandidates(e,i,n,r){if(n.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==i&&this._resetSnappingState(),jo(e,n);const o=this._currentMainCandidate;if(o!=null){const a=Ks(o,n);if(a>=0){if(!(n[a]instanceof gt))return this._intersectWithOtherCandidates(a,n,e,i,r);if(this._arePointsWithinScreenThreshold(e,o.targetPoint,r))return this._updateSnappingCandidate(o,i,n,r)}}return this._intersectWithOtherCandidates(0,n,e,i,r)}_intersectWithOtherCandidates(e,i,n,r,o){const{coordinateHelper:a}=o,s=i[e],p=[];for(let l=0;l<i.length;++l){if(l===e)continue;const u=i[l],d=s.constraint.intersect(u.constraint);if(d)for(const v of d.closestPoints(s.targetPoint))p.push([new gt(Ft(v),s,u,u.isDraped),this._squaredScreenDistance(n,v,a)])}return p.length>0&&(p.sort((l,u)=>l[1]-u[1]),p[0][1]<this._squaredPointProximityThreshold(o.pointer))?this._updateSnappingCandidate(p[0][0],r,i,o):Wt(s,o.drawConstraints)?this._updateSnappingCandidate(s,r,i,o):{snappedPoint:n,hints:[]}}_updateSnappingCandidate(e,i,n,r){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=i;const o=this._currentMainCandidate.targetPoint,a=[];a.push(...e.hints);for(const s of n){if(e instanceof gt){if(s.constraint.equals(e.first.constraint)||s.constraint.equals(e.second.constraint))continue}else if(s.constraint.equals(e.constraint))continue;const p=s.constraint.closestTo(o);this._squaredScreenDistance(p,o,r.coordinateHelper)<Ws()&&(s.targetPoint=o,this._currentOtherActiveCandidates.push(s),a.push(...s.hints))}return{snappedPoint:o,hints:a}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,i,n){return this._squaredScreenDistance(e,i,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}_squaredScreenDistance(e,i,n){return On(this._toScreen(e,n),this._toScreen(i,n))}_toScreen(e,i){return Hs(e,i.spatialReference,Ce,this.view)}get test(){}};var fe;c([h({constructOnly:!0})],X.prototype,"view",void 0),c([h()],X.prototype,"options",void 0),c([h({readOnly:!0})],X.prototype,"updating",null),c([h()],X.prototype,"_loadTask",void 0),c([h()],X.prototype,"_engines",void 0),c([h()],X.prototype,"_squaredMouseProximityThreshold",null),c([h()],X.prototype,"_squaredTouchProximityThreshold",null),X=c([I("esri.views.interactive.snapping.SnappingManager")],X),function(t){t[t.MAIN=0]="MAIN",t[t.SCENE=1]="SCENE"}(fe||(fe={}));const Bt="visualization-handle";function Ws(){return St.satisfiesConstraintScreenThreshold*St.satisfiesConstraintScreenThreshold}function Wt(t,e){return!e||e.direction==null&&e.distance==null||!(t instanceof Ps||t instanceof As||t instanceof Ls||t instanceof Cs||t instanceof Ns)&&(!(t instanceof Ds)||e.direction==null&&t.selfSnappingType===Pt.LastVertex)}function Ks(t,e){return t instanceof gt?Kt(e,t.first)>=0&&Kt(e,t.second)>=0?0:-1:Kt(e,t)}function Kt(t,e){let i=-1;for(let n=0;n<t.length;++n)if(e.constraint.equals(t[n].constraint)){i=n;break}return i}function Js(t){return t.scenePoint!=null}function Qs({coordinateHelper:t,elevationInfo:e}){return t.hasZ()?Ce:e}function Ri(t){return gr(t)?vr(t)||sn(t)||mr(t)||_r(t)?Ro:t:Mo(t)}function Xs(t,e=At()){return Qn(t,e)}function ea(t,e=At()){return Qn(t,e,!1)}function Qn(t,e,i=t.hasZ){const n=Ri(t.spatialReference),r=Er(n);if(r==null)return null;const o=(s,p)=>!(p.length<2)&&(z(s,p[0],p[1],i&&p[2]||0),!0);let a=0;for(const s of t.rings){const p=s.length;if(p<3)continue;const{positionsWorldCoords:l}=e;for(;l.length<p;)l.push(m());const u=ta,d=z(ia,0,0,0),v=1/p;for(let g=0;g<p;g++){if(!o(u,s[g])||!be(u,t.spatialReference,l[g],n))return null;x(d,d,l[g],v)}const y=mn(l[0],l[1],d,vo());if(dn(ui(y))===0)continue;for(let g=0;g<p;g++)mo(y,d,l[g],l[g]);const f=na(l);for(let g=0;g<f.length;g+=3)a+=$o(l[f[g]],l[f[g+1]],l[f[g+2]])}return ci(a,r)}const ta=m(),ia=m();function At(){return{positionsWorldCoords:[]}}function na(t){return Oo(ra(t),[],2)}function ra(t){const e=new Float64Array(2*t.length);for(let i=0;i<t.length;++i){const n=t[i],r=2*i;e[r]=n[0],e[r+1]=n[1]}return e}const oa=t=>({geodesicArea(e){const{spatialReference:i}=e;return $i(i,aa,n=>la(t,n),e)}});async function sa(){const t=await D(()=>import("./geometryEngine-BZn6akp0.js"),__vite__mapDeps([63,1,2,3,64,65,66]),import.meta.url);return oa(t)}function aa(t){return ci(Math.abs(ao([t],"square-meters")[0]),"square-meters")}function la(t,e){try{return ci(Math.abs(t.geodesicArea(e,"square-meters")),"square-meters")}catch{return null}}const pa=t=>({autoAreaByElevationMode(e,i,n=At()){if(i==="on-the-ground"){const r=t.geodesicArea(e);return r??ea(e,n)}return Xs(e,n)},autoArea2D(e,i=At()){return this.autoAreaByElevationMode(e,"on-the-ground",i)}});let Jt=null;async function lt(){return Jt||(Jt=pa(await sa())),Jt}var ae;function ca(t){return ua(t,ae.Horizontal)}function ua(t,e){const{hasZ:i,spatialReference:n}=t,r=Ri(n);let o=0;const a=an(r);if(a==null)return null;const s=e===ae.Direct?ya:Mi;for(const p of t.paths){if(p.length<2)continue;const l=p.length-1;for(let u=0;u<l;++u){const d=p[u];Z[0]=d[0],Z[1]=d[1],Z[2]=i?d[2]:0;const v=p[u+1];Y[0]=v[0],Y[1]=v[1],Y[2]=i?v[2]:0;const y=s(Z,Y,n);if(y==null)return null;o+=y.value}}return ve(o,a)}function ha(t,e){const{spatialReference:i}=t;return Je(i,e.spatialReference)?(Z[0]=t.x,Z[1]=t.y,Z[2]=t.hasZ?t.z:0,Y[0]=e.x,Y[1]=e.y,Y[2]=e.hasZ?e.z:0,Mi(Z,Y,i)):null}function kl(t,e){const{spatialReference:i}=t;return Je(i,e.spatialReference)?(Z[0]=t.x,Z[1]=t.y,Z[2]=t.hasZ?t.z:0,Y[0]=e.x,Y[1]=e.y,Y[2]=e.hasZ?e.z:0,fa(Z,Y,i)):null}function Hl(t){return t!=null?da(t.hasZ?t.z:0,t.spatialReference):null}function da(t,e){const i=br(e);return i!=null?ve(t??0,i):null}function ya(t,e,i){const n=Pi(t,e,i,ae.Direct);return n!=null?ve(n.direct,n.unit):null}function Mi(t,e,i){const n=Pi(t,e,i,ae.Horizontal);return n!=null?ve(n.horizontal,n.unit):null}function fa(t,e,i){const n=Pi(t,e,i,ae.Vertical);return n!=null?ve(n.verticalSigned,n.unit):null}function Pi(t,e,i,n){const r=Ri(i),o=an(r);if(o==null)return null;const a=e[2]-t[2];if(n===ae.Vertical)return{verticalSigned:a,unit:o};if(!be(t,i,Qt,r)||!be(e,i,pt,r))return null;if(n===ae.Direct)return{direct:Ye(pt,Qt),unit:o};if(z(ct,t[0],t[1],e[2]),!be(ct,i,ct,r))return null;const s=Ye(ct,pt);return n===ae.Horizontal?{horizontal:s,unit:o}:{direct:Ye(pt,Qt),horizontal:s,vertical:Math.abs(a),unit:o}}(function(t){t[t.Direct=0]="Direct",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"})(ae||(ae={}));const Z=m(),Y=m(),Qt=m(),pt=m(),ct=m();function ga(t){return{autoLength2D:e=>t.geodesicLength(e)??ca(e),autoDistanceBetweenPoints2D:(e,i)=>t.geodesicDistanceBetweenPoints(e,i)??ha(e,i),autoDistance2D:(e,i,n)=>(je[0]=e[0],je[1]=e[1],je[2]=e.length===3?e[2]:0,Fe[0]=i[0],Fe[1]=i[1],Fe[2]=i.length===3?i[2]:0,t.geodesicDistance(je,Fe,n)??Mi(je,Fe,n))}}async function $e(){return ga(await Jn())}const je=m(),Fe=m();function va(t){return t?.type==="graphic"}function ma(t){return t.find(va)??null}let L=class extends li.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:wr(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const e=this.activeComponent;e&&(e.type!=="box"&&e.type!=="reshape"&&e.type!=="graphic-mover"||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};c([h()],L.prototype,"activeComponent",void 0),c([h()],L.prototype,"cancelled",void 0),c([h()],L.prototype,"history",void 0),c([h()],L.prototype,"tool",null),c([h()],L.prototype,"type",void 0),c([h()],L.prototype,"canUndo",null),c([h()],L.prototype,"canRedo",null),c([h()],L.prototype,"onEnd",void 0),c([h()],L.prototype,"undo",null),c([h()],L.prototype,"redo",null),c([h()],L.prototype,"toggleTool",void 0),c([h()],L.prototype,"addToSelection",void 0),c([h()],L.prototype,"removeFromSelection",void 0),L=c([I("esri.widgets.Sketch.support.OperationHandle")],L);let vt=class extends L{};c([h()],vt.prototype,"activeComponent",void 0),vt=c([I("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],vt);let ge=class extends L{};c([h()],ge.prototype,"activeComponent",void 0),ge=c([I("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],ge);function _a(t,e){return e==="freehandPolygon"||e==="freehandPolyline"?"freehand":t??(e==="rectangle"||e==="circle"?"hybrid":"click")}function Ea(t){switch(t){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return t}}var Xi;(function(t){t[t.ForceCollapse=-1]="ForceCollapse",t[t.Low=0]="Low",t[t.Medium=10]="Medium",t[t.High=100]="High",t[t.Max=1e3]="Max"})(Xi||(Xi={}));const en={defaultZ:0},ze={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:qr},tool:"transform"};let E=class extends li.EventedAccessor{constructor(t){super(t),this._defaultSnappingManager=null,this._updatingHandles=new Lr,this._internalGraphicsLayer=new kr({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new Ai({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Tr({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Sr({color:[130,130,130,1],width:2}),this.meshSymbol=new Or({symbolLayers:new Me([new $r])}),this.updateGraphics=new Me,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new Ai({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new Tn,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=en,this.defaultUpdateOptions=ze,this.snappingOptions=t?.snappingManager?.options??t?.snappingOptions??new G}initialize(){this.addHandles([Gi(()=>this.view?.map?.layers,"change",t=>{t.removed.includes(this.layer)&&this.cancel()}),Gi(()=>this.layer?.graphics,"change",t=>{if(this._operationHandle!=null)for(const e of t.removed)this.updateGraphics.includes(e)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(e):this._operationHandle.cancel())}),Re(()=>this.layer?.elevationInfo??null,t=>{t!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=t)},Ze),Re(()=>this.view,t=>{this._defaultSnappingManager=rt(this._defaultSnappingManager),t&&(this.snappingManager||(this._defaultSnappingManager=new X({view:t,options:this.snappingOptions})),t.type==="2d"?D(()=>import("./editingTools-CM2Dt3TR.js"),__vite__mapDeps([67,1,2,3,68,9,10,11,69,70,71,12,5,72,33,73,74,24,42,75,41,43,37,76,77,78,27,28,29,79,80,81,82,83,84,85,86,4,87,88,89,15,16,17,18,19,20,21,22,23,25,7,8,62,90,91,92,93,94,13,95,32,14,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,6,111,112,38,39,40,113,30,31,114,115,116,44,45,50,117,118,119,120,121,122,26,34,35,36,46,47,48,49,51]),import.meta.url):t.type==="3d"&&(D(()=>import("./ImageMaterial.glsl-CaAjzY1X.js").then(e=>e.e),__vite__mapDeps([123,1,2,3,121,37,10,38,12,6,7,8,73,33,72,5,74,24,42,75,41,43,76,77,78,27,28,29,79,80,81,82,83,84,85,86,4,87,88,89,15,16,17,18,19,20,21,22,23,25,62,90,91,92,93,9,11,40,124,30,14,31,125,44,45,39,126,50,127,111,128,51,129,130,131,132,133,134,135,136,137,138,49,139,140,141,142,143,116,144,145,146,113,147,148,149,150,151,48,152,153,154,155,156,114,115,157,158,70,71,159,94,13,95,32,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,112,160,161,162,117,118,119,69,163,164,165,166,120]),import.meta.url),D(()=>import("./LineCallout.glsl-BonNGxxK.js").then(e=>e.G),__vite__mapDeps([167,1,2,3,168,169,14,31,30,6,7,8,127,24,10,42,9,11,12,37,38,125,44,45,41,40,43,39,126,111,128,75,51,129,130,131,132,133,134,135,136,137,138,49,50,139,140,141,142,143,116,144,145,146,77,78,113,147,148,149,110,13,17,18,170,34,35,36,164,171,155,114,115,172,173,174,175,176,177,178,23,73,179,160,180,181,182,183,184,185,33,186,187,188,189,190,191,27,28,29,62,192]),import.meta.url)))},Ze),Re(()=>this.view?.spatialReference,(t,e)=>{t&&e&&!t.equals(e)&&this.cancel()})]),zo(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=rt(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||this.snappingManager!=null&&this.snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:t,destroyed:e}=this,i=!e&&t&&"tooltip"in t?t.tooltip:null;return i?.visible?i:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(t){this._set("defaultCreateOptions",{...en,...t})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(t){this._set("defaultUpdateOptions",{...ze,...t,reshapeOptions:{...ze.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...ze.highlightOptions,...t?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(t){this.sketchOptions.labels=t}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(t){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=t),this._set("snappingOptions",t)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(t){if(t)this._isOverridden("snappingManager")||(this._defaultSnappingManager=rt(this._defaultSnappingManager)),this._override("snappingManager",t);else{const{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new X({options:this.snappingOptions,view:e})),this._clearOverride("snappingManager")}}get state(){const t=!(!this.view?.ready||!this.layer),e=this._operationHandle;return t&&e?"active":t?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(t){this.sketchOptions.tooltips=t}get valueOptions(){return this.sketchOptions.values}set valueOptions(t){this.sketchOptions.values=t}get view(){return this._get("view")}set view(t){const e=this._get("view");if(e){const{container:n,map:r}=e;n&&(e.cursor=null),r?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const i="view-ready";this.removeHandles(i),t&&this.addHandles(Rr(()=>t.ready,n=>{this.removeHandles(this._viewHandlesKey),n&&this.addHandles(this._generateViewHandles(t),this._viewHandlesKey)},Ze),i),this._set("view",t)}cancel(){this._moduleLoaderAbortController=jt(this._moduleLoaderAbortController),this._viewReadyAbortController=jt(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:t,updateGraphics:e}=this;if(t==="active"&&e.length){const{activeTool:i,layer:n}=this,r=e.toArray();n.removeMany(r),this.cancel(),this._emitDeleteEvent({graphics:r,tool:i})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const t=this.updateGraphics.map(e=>e.clone()).toArray();return this.layer.addMany(t),this.emit("duplicate",{graphics:t,type:"duplicate"}),t}return[]}async create(t,e){this.cancel(),await this._waitViewReady();const{view:i,layer:n}=this;if(!i||this.state==="disabled")throw n||this._logMissingLayer(),Li();if(i.activeTool!=null&&(i.activeTool=null),!t)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");Fi(i,this._internalGraphicsLayer);const r=await this._updatingHandles.addPromise(this._setupCreateOperation(t,e));if(r==null||this.destroyed)return void i.map.remove(this._internalGraphicsLayer);const o=()=>{if(r===this._operationHandle){const a=this.createGraphic,s=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map&&this.view.map.remove(this._internalGraphicsLayer),r.cancelled||a==null||n.add(a),this._sketchContinuationFlag=!1,this.emit("create",{graphic:a,state:s?"cancel":"complete",tool:t,toolEventInfo:null,type:"create"}),s||this._sketchContinuationFlag)return;const{creationMode:p}=this;if(p==="continuous"){if(e?.geometryToPlace)return;this._updatingHandles.addPromise(Di(this.create(t,e)))}else p==="update"&&a&&this._updatingHandles.addPromise(Di(this.update([a])))}};r.on("complete",o),this._operationHandle=r,i.ready&&i.focus()}async place(t,e){return this.create("mesh",{mode:"click",hasZ:t.hasZ,geometryToPlace:t,...e})}async update(t,e){this.cancel(),await this._waitViewReady();const{layer:i,view:n,state:r}=this;if(!n||r==="disabled")throw i||this._logMissingLayer(),Li();n.activeTool!=null&&(n.activeTool=null);const o=Array.isArray(t)?t:[t];if(t==null||!o?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(o.some(s=>s.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):s.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const a=await this._updatingHandles.addPromise(this._setupUpdateOperation(o,e));this.destroyed||a==null||P(a)||(Fi(n,this._internalGraphicsLayer),this._setUpdateOperationHandle(a,e),this.emit("update",{graphics:o,state:"start",aborted:!1,tool:a.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(t){const e=this.view;if(e){t=Array.isArray(t)?t:[t];for(const i of t)i.geometry==null||i.geometry.type==="mesh"||Je(i.geometry.spatialReference,e.spatialReference)||(Dr(i.geometry.spatialReference,e.spatialReference)||Nr()||await Ir(),i.geometry=Xt(i.geometry,e.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(t){const e=this.view;if(!e)return this._logMissingView(),null;if(e.type==="2d"){const r=[];e.map.allLayers.forEach(a=>{a.type!=="vector-tile"&&a.type!=="imagery"||r.push(a)});const o=await e.hitTest(t,{exclude:r});return ma(o.results)}const i=[e.map.ground];e.map.allLayers.forEach(r=>{Mr(r.type)&&i.push(r)});const n=await e.hitTest(t,{exclude:i});if(n.results.length>0){const r=n.results[0];if(r!=null&&r.type==="graphic"&&r.graphic&&(!n.ground.mapPoint||e.map.ground.opacity<1||n.ground.distance-(r.distance??0)>-Math.min(3*n.ground.distance,e.viewingMode==="global"?Pr(e.renderCoordsHelper.spatialReference).radius/e.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return r}return null}_generateViewHandles(t){return[t.on("immediate-click",async e=>{const i=this.state==="active"&&this._operationHandle?.type==="create";this.state!=="disabled"&&!i&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(e))},A.WIDGET)]}async _handleImmediateClick(t){const e=await t.defer(()=>this._getFirstHit(Ii(t)));let i=null;if(e!=null){const n=e.graphic;this.updateGraphics.includes(n)||n.layer===this.layer?(t.stopPropagation(),i=n):this.view?.type!=="2d"||this._isComponentGraphic(n)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();i==null||this.updateGraphics.includes(i)||await this.update([i],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(t,e){const i=this.view;if(!i)return this._logMissingView(),null;const n={hasZ:i.type==="3d",...this.defaultCreateOptions,...e},r=await this._setupDrawGraphicTool(t,i,n);return r==null?null:(i.tools.add(r),i.activeTool=r,this._setupCreateOperationHandle(r))}async _setupDrawGraphicTool(t,e,i){if(t==="multipoint"&&e.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!e)return this._logMissingView(),null;const{cursor:n,defaultZ:r,hasZ:o,geometryToPlace:a,graphicProperties:s,mode:p,preserveAspectRatio:l}=i,u=_a(p,t),d=Ea(t),v=i?.optionsPerTool?.has(t)?i.optionsPerTool.get(t):{},y=v?.preserveAspectRatio??l??t!=="rectangle",f={centered:t!=="rectangle"&&!(t==="circle"&&!y),cursor:n,defaultZ:r,forceUniformSize:y,graphicProperties:{...s,attributes:{...s?.attributes}},geometryToPlace:a,geometryType:d,mode:u,graphicSymbol:this._getGraphicSymbolFromTool(t),hasZ:o,snappingManager:this.snappingManager,snapToScene:!1,view:e,...v};return e.type==="2d"?this._makeDrawGraphicTool2D(f):this._makeDrawGraphicTool3D(f)}async _makeDrawGraphicTool2D(t){const[e,i,n]=await Promise.all([this._requireModule(D(()=>import("./editingTools-CM2Dt3TR.js"),__vite__mapDeps([67,1,2,3,68,9,10,11,69,70,71,12,5,72,33,73,74,24,42,75,41,43,37,76,77,78,27,28,29,79,80,81,82,83,84,85,86,4,87,88,89,15,16,17,18,19,20,21,22,23,25,7,8,62,90,91,92,93,94,13,95,32,14,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,6,111,112,38,39,40,113,30,31,114,115,116,44,45,50,117,118,119,120,121,122,26,34,35,36,46,47,48,49,51]),import.meta.url)),lt(),$e()]);return P(e)||this.destroyed?null:new e.module.DrawGraphicTool2D({...t,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:wa(t.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:n})}async _makeDrawGraphicTool3D(t){const[e,i,n]=await Promise.all([this._requireModule(D(()=>import("./ImageMaterial.glsl-CaAjzY1X.js").then(o=>o.e),__vite__mapDeps([123,1,2,3,121,37,10,38,12,6,7,8,73,33,72,5,74,24,42,75,41,43,76,77,78,27,28,29,79,80,81,82,83,84,85,86,4,87,88,89,15,16,17,18,19,20,21,22,23,25,62,90,91,92,93,9,11,40,124,30,14,31,125,44,45,39,126,50,127,111,128,51,129,130,131,132,133,134,135,136,137,138,49,139,140,141,142,143,116,144,145,146,113,147,148,149,150,151,48,152,153,154,155,156,114,115,157,158,70,71,159,94,13,95,32,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,112,160,161,162,117,118,119,69,163,164,165,166,120]),import.meta.url)),lt(),$e()]);if(P(e)||this.destroyed)return null;const{elevationInfo:r}=this.layer;return new e.module.DrawGraphicTool3D({...t,elevationInfo:r,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:n})}_setupCreateOperationHandle(t){const e=this.view;if(!e)return this._logMissingView(),null;let i=null;const n=t.forceUniformSize,r=t.centered,o=[e.on("key-down",s=>{if(s.key===M.pan)s.stopPropagation(),s.repeat||(t.enabled=!1);else if(s.key===M.complete)s.stopPropagation(),t.completeCreateOperation();else if(s.key!==M.vertexAdd||s.repeat)s.key===M.undo?(s.stopPropagation(),a.undo()):s.key===M.redo?(s.stopPropagation(),a.redo()):s.key!==M.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"||s.repeat?s.key===M.center&&(s.repeat||(t.centered=!r,s.stopPropagation())):(t.forceUniformSize=!n,s.stopPropagation());else{const p=t.drawOperation.geometryType;p!=="polyline"&&p!=="polygon"&&p!=="multipoint"||(s.stopPropagation(),t.drawOperation.commitStagedVertex())}},A.WIDGET),e.on("key-up",s=>{s.key===M.pan?t.enabled=!0:s.key!==M.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"?s.key===M.center&&(t.centered=r,s.stopPropagation()):(t.forceUniformSize=n,s.stopPropagation())},A.WIDGET),t.on("vertex-add",s=>{switch(i=i==null?"start":"active",s.operation){case"apply":this.emit("create",{graphic:t.graphic,state:i,tool:this.activeTool,toolEventInfo:s,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("cursor-update",s=>{t.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:s.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),t.on("vertex-remove",s=>{switch(s.operation){case"apply":this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:s,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("complete",s=>{this._set("createGraphic",s.graphic),i="complete",s.aborted?a&&a.cancel():a&&a.complete()}),Re(()=>this._getGraphicSymbolFromTool(t.geometryType),s=>{t.graphicSymbol=s})],a=new vt({activeComponent:t,tool:t.geometryType,type:"create",onEnd:()=>{ie(o),e.tools?.remove(t)},undo:()=>{t.canUndo&&t.undo()},redo:()=>{t.canRedo&&t.redo()},canUndo:()=>t.canUndo,canRedo:()=>t.canRedo});return a}_getGraphicSymbolFromTool(t){switch(t){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(t,e){const{layer:i,view:n}=this;if(!n)return this._logMissingView(),null;const r={...this.defaultUpdateOptions,...e,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...e?.highlightOptions}};let o=r.tool??ze.tool;for(const a of t)i.remove(a),i.add(a);if(n.type==="3d"){if(t.length===0)return null;switch(o){case"move":return this._setupMove3DOperation(t,r,n,o);case"reshape":return t.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(t[0],r,n);case"transform":return this._setupGraphicTransform3DOperation(t,r,n)}}switch(o){case"move":return this._setupMove2DOperation(t,r,n);case"reshape":return t.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(t,o,r,n);case"transform":if(t.length===1){const a=t[0].geometry?.type;a!=="point"&&a!=="multipoint"||(o="reshape")}return this._setupTransformOrReshape2DOperation(t,o,r,n)}}async _setupMove3DOperation(t,e,i,n,r=!1){const[o,a]=await Promise.all([this._requireModule(D(()=>import("./ImageMaterial.glsl-CaAjzY1X.js").then(f=>f.e),__vite__mapDeps([123,1,2,3,121,37,10,38,12,6,7,8,73,33,72,5,74,24,42,75,41,43,76,77,78,27,28,29,79,80,81,82,83,84,85,86,4,87,88,89,15,16,17,18,19,20,21,22,23,25,62,90,91,92,93,9,11,40,124,30,14,31,125,44,45,39,126,50,127,111,128,51,129,130,131,132,133,134,135,136,137,138,49,139,140,141,142,143,116,144,145,146,113,147,148,149,150,151,48,152,153,154,155,156,114,115,157,158,70,71,159,94,13,95,32,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,112,160,161,162,117,118,119,69,163,164,165,166,120]),import.meta.url)),$e()]);if(P(o))return o;const{ManipulatedObject3DGraphic:s,MoveTool3D:p}=o.module,l=new Map,u=()=>{l.forEach(f=>f.destroy()),l.clear()};for(const f of t){const g=new s({view:i,graphic:f}),_=Do(g);if(_!==b.SUPPORTED)return u(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${ji(_)}).`),null;l.set(f,g)}const d=new p({view:i,enableZ:e.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:a});i.tools.add(d),d.objects.addMany(Array.from(l.values())),r||this.updateGraphics.addMany(t);const v=[],y=new ge({activeComponent:d,tool:n,type:"update",onEnd:()=>{ie(v),dt(i,d),u()},undo:()=>{nn(this.view,d),ut(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{ht(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:f=>{this.updateGraphics.push(f);const g=new s({view:i,graphic:f});l.set(f,g),d.objects.push(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[f],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:f=>{const g=this.updateGraphics.indexOf(f);if(y.history.undo.forEach(O=>O.updates.splice(g,1)),y.history.redo.forEach(O=>O.updates.splice(g,1)),this.updateGraphics.remove(f),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[f],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void y.complete();const _=l.get(f);_&&(d.objects.remove(_),_.destroy(),l.delete(f))},toggleTool:async()=>{if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1||n!=="transform")return;const f=this.updateGraphics.at(0),g=await this._setupReshape3DOperation(f,e,i,!0);g&&!P(g)&&(y.onEnd(),y.destroy(),this._setUpdateOperationHandle(g,e))}});return v.push(...this._getHandlesForComponent(y,e),i.on("immediate-click",f=>this._getCommonUpdateOperationClickHandlers(y,f,e),A.WIDGET),i.on("key-down",f=>{this._getCommonUpdateOperationKeyDownHandlers(y,f)},A.WIDGET)),y}_setupGraphicTransform3DOperation(t,e,i,n=!1){if(t.length===1&&ko(t[0])===b.SUPPORTED){const r=t[0],o=r.geometry;if(o!=null&&(o.type==="point"||o.type==="mesh"))return this._setupPointTransform3DOperation(r,e,i);if(o!=null&&(o.type==="polygon"||o.type==="polyline"))return this._setupPolyTransform3DOperation(r,e,i,n)}return this._setupMove3DOperation(t,e,i,"transform",n)}async _setupPointTransform3DOperation(t,e,i){const n="transform",{enableRotation:r,enableScaling:o,enableZ:a}=e,s=await this._requireModule(D(()=>import("./ImageMaterial.glsl-CaAjzY1X.js").then(f=>f.e),__vite__mapDeps([123,1,2,3,121,37,10,38,12,6,7,8,73,33,72,5,74,24,42,75,41,43,76,77,78,27,28,29,79,80,81,82,83,84,85,86,4,87,88,89,15,16,17,18,19,20,21,22,23,25,62,90,91,92,93,9,11,40,124,30,14,31,125,44,45,39,126,50,127,111,128,51,129,130,131,132,133,134,135,136,137,138,49,139,140,141,142,143,116,144,145,146,113,147,148,149,150,151,48,152,153,154,155,156,114,115,157,158,70,71,159,94,13,95,32,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,112,160,161,162,117,118,119,69,163,164,165,166,120]),import.meta.url));if(P(s))return s;const{TransformTool3D:p,ManipulatedObject3DGraphic:l}=s.module,u=new l({graphic:t,view:i}),d=new p({object:u,view:i,enableRotation:r,enableScaling:o,enableZ:a,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(d),this.updateGraphics.add(t);const v=[],y=new ge({activeComponent:d,tool:n,type:"update",onEnd:()=>{ie(v),dt(i,d),u.destroy()},undo:()=>{nn(this.view,d),ut(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{ht(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:async f=>{this.updateGraphics.add(f),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[f],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const g=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);P(g)||this._setUpdateOperationHandle(g,e)},removeFromSelection:f=>{this.updateGraphics.remove(f),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[f],type:"selection-change"},type:"update"}),y.complete()},toggleTool:()=>{}});return v.push(...this._getHandlesForComponent(y,e),i.on("immediate-click",f=>this._getCommonUpdateOperationClickHandlers(y,f,e),A.WIDGET),i.on("key-down",f=>{this._getCommonUpdateOperationKeyDownHandlers(y,f)},A.WIDGET)),y}async _setupPolyTransform3DOperation(t,e,i,n=!1){const r="transform",{enableRotation:o,enableScaling:a,enableZ:s,preserveAspectRatio:p}=e,[l,u]=await Promise.all([this._requireModule(D(()=>import("./ImageMaterial.glsl-CaAjzY1X.js").then(S=>S.e),__vite__mapDeps([123,1,2,3,121,37,10,38,12,6,7,8,73,33,72,5,74,24,42,75,41,43,76,77,78,27,28,29,79,80,81,82,83,84,85,86,4,87,88,89,15,16,17,18,19,20,21,22,23,25,62,90,91,92,93,9,11,40,124,30,14,31,125,44,45,39,126,50,127,111,128,51,129,130,131,132,133,134,135,136,137,138,49,139,140,141,142,143,116,144,145,146,113,147,148,149,150,151,48,152,153,154,155,156,114,115,157,158,70,71,159,94,13,95,32,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,112,160,161,162,117,118,119,69,163,164,165,166,120]),import.meta.url)),$e()]);if(P(l))return l;const{ManipulatedObject3DGraphic:d,ExtentTransformTool:v}=l.module,y=this.view?.inputManager?.isModifierKeyDown(M.constraint),f=new d({view:i,graphic:t}),g=new v({object:f,view:i,enableRotation:o,enableScaling:a,enableZ:s,preserveAspectRatio:!!p!=!!y,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:u});i.tools.add(g),n||this.updateGraphics.add(t);const _=[],O=new ge({activeComponent:g,tool:r,type:"update",onEnd:()=>{ie(_),dt(i,g),f.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},addToSelection:async S=>{this.updateGraphics.add(S),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[S],removed:[],type:"selection-change"},type:"update"}),O.onEnd(),O.destroy();const Oe=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);P(Oe)||this._setUpdateOperationHandle(Oe,e)},removeFromSelection:S=>{this.updateGraphics.remove(S),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[S],type:"selection-change"},type:"update"}),O.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1)return;const S=await this._setupReshape3DOperation(t,e,i,!0);S&&!P(S)&&(O.onEnd(),O.destroy(),this._setUpdateOperationHandle(S,e))}});return _.push(...this._getHandlesForComponent(O,e),i.on("immediate-click",S=>this._getCommonUpdateOperationClickHandlers(O,S,e),A.WIDGET),i.on("key-down",S=>this._getCommonUpdateOperationKeyDownHandlers(O,S),A.WIDGET),i.on("key-down",S=>{S.key!==M.constraint||S.repeat||(g.preserveAspectRatio=!g.preserveAspectRatio,S.stopPropagation())},A.WIDGET),i.on("key-up",S=>{S.key===M.constraint&&(g.preserveAspectRatio=!g.preserveAspectRatio,S.stopPropagation())},A.WIDGET)),O}async _setupMove2DOperation(t,e,i){const n="move";this.updateGraphics.addMany(t),await this._updatingHandles.addPromise(this._updateSpatialReference(t));const r=await this._getGraphicMover(t,e,i);if(P(r))return r;const o=new ge({activeComponent:r,tool:n,type:"update",onEnd:()=>{this._displayDefaultCursor(),ie(p),ie(s),r.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const l=this.updateGraphics.toArray();ut(o,l),o.refreshComponent(),this._emitUndoEvent({graphics:l,tool:n})},redo:()=>{const l=this.updateGraphics.toArray();ht(o,l),o.refreshComponent(),this._emitRedoEvent({graphics:l,tool:n})},addToSelection:async l=>{await this._updatingHandles.addPromise(this._updateSpatialReference(l)),this.updateGraphics.push(l),r.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[l],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:l=>{const u=this.updateGraphics.indexOf(l);o.history.undo.forEach(v=>v.updates.splice(u,1)),o.history.redo.forEach(v=>v.updates.splice(u,1)),this.updateGraphics.remove(l);const d=this.updateGraphics.toArray();this.emit("update",{graphics:d,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[l],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?r.graphics=d:o.complete()}});let a=!1;const s=[i.on("immediate-click",l=>this._getCommonUpdateOperationClickHandlers(o,l,e),A.WIDGET),i.on("key-down",l=>{this._getCommonUpdateOperationKeyDownHandlers(o,l),l.key!==M.constraint||l.repeat||(a=!0,r.enableMoveAllGraphics=!r.enableMoveAllGraphics)},A.WIDGET),i.on("key-up",l=>{l.key===M.constraint&&a&&(a=!1,r.enableMoveAllGraphics=!r.enableMoveAllGraphics)},A.WIDGET)],p=this._getHandlesForComponent(o,e);return o}async _setupReshape3DOperation(t,e,i,n=!1){const r="reshape",[o,a,s]=await Promise.all([this._requireModule(D(()=>import("./ImageMaterial.glsl-CaAjzY1X.js").then(_=>_.e),__vite__mapDeps([123,1,2,3,121,37,10,38,12,6,7,8,73,33,72,5,74,24,42,75,41,43,76,77,78,27,28,29,79,80,81,82,83,84,85,86,4,87,88,89,15,16,17,18,19,20,21,22,23,25,62,90,91,92,93,9,11,40,124,30,14,31,125,44,45,39,126,50,127,111,128,51,129,130,131,132,133,134,135,136,137,138,49,139,140,141,142,143,116,144,145,146,113,147,148,149,150,151,48,152,153,154,155,156,114,115,157,158,70,71,159,94,13,95,32,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,112,160,161,162,117,118,119,69,163,164,165,166,120]),import.meta.url)),lt(),$e()]);if(P(o))return o;const{ManipulatedObject3DGraphic:p,ReshapeTool3D:l}=o.module,u=new p({view:i,graphic:t}),d=No(u);if(d!==b.SUPPORTED)return u.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${ji(d)}).`),null;const v=e.reshapeOptions,y=new l({view:i,object:u,enableZVertex:e.enableZ&&v?.vertexOperation==="move",enableZShape:e.enableZ&&v?.shapeOperation==="move",enableMoveObject:v?.shapeOperation==="move"||v?.shapeOperation==="move-xy",enableMidpoints:v?.edgeOperation==="split",enableEdgeOffset:v?.edgeOperation==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:a,automaticLengthMeasurementUtils:s});i.tools.add(y),n||this.updateGraphics.add(u.graphic);const f=[],g=new ge({activeComponent:y,tool:r,type:"update",onEnd:()=>{ie(f),dt(i,y),u.destroy()},canUndo:()=>!y.destroyed&&y.canUndo,undo:()=>{y.destroyed||(y.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},canRedo:()=>!y.destroyed&&y.canRedo,redo:()=>{y.destroyed||(y.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},addToSelection:async _=>{this.updateGraphics.add(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[_],removed:[],type:"selection-change"},type:"update"}),g.onEnd(),g.destroy();const O=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,i,"transform",!0);P(O)||this._setUpdateOperationHandle(O,e)},removeFromSelection:_=>{this.updateGraphics.remove(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[_],type:"selection-change"},type:"update"}),g.complete()},toggleTool:async()=>{if(e.toggleToolOnClick===!1)return;g.onEnd(),g.destroy();const _=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),e,i,!0);P(_)||this._setUpdateOperationHandle(_,e)}});return f.push(...this._getHandlesForComponent(g,e),i.on("immediate-click",_=>this._getCommonUpdateOperationClickHandlers(g,_,e),A.WIDGET),i.on("key-down",_=>{this._getCommonUpdateOperationKeyDownHandlers(g,_)},A.WIDGET)),g}async _setupTransformOrReshape2DOperation(t,e,i,n){this.updateGraphics.addMany(t),await this._updatingHandles.addPromise(this._updateSpatialReference(t));const r=e==="transform"?await this._getBox(t,i,n):await this._getReshape(t,i,n);if(P(r))return r;const o=new ge({activeComponent:r,type:"update",onEnd:()=>{ie(s),ie(a),o.activeComponent&&!o.activeComponent.destroyed&&o.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{ut(o,this.updateGraphics.toArray()),o.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o.tool})},redo:()=>{ht(o,this.updateGraphics.toArray()),o.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o.tool})},addToSelection:async p=>{let l=o.activeComponent;if(l?.type==="reshape"){const u=[...this.updateGraphics,p];this.updateGraphics.removeAll(),o.onEnd(),o.destroy();const d=await this._setupTransformOrReshape2DOperation(u,"transform",i,n);if(P(d))return;this._setUpdateOperationHandle(d,i)}else this.updateGraphics.add(p),l.graphics=this.updateGraphics.toArray(),l.refresh(),o.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[p],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async p=>{const l=this.updateGraphics.indexOf(p);o.history.undo.forEach(d=>d.updates.splice(l,1)),o.history.redo.forEach(d=>d.updates.splice(l,1)),this.updateGraphics.remove(p);const u=this.updateGraphics.toArray();if(u.length===0)o.complete();else{const d=u[0].geometry;u.length!==1||d==null||d.type!=="point"&&d.type!=="multipoint"?o.activeComponent.graphics=u:o.toggleTool()}this.emit("update",{graphics:u,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[p],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const p=this.updateGraphics.at(0),l=p.geometry;if(l!=null&&(o.tool==="reshape"&&(l.type==="point"||l.type==="multipoint")||o.tool==="transform"&&l.type==="extent"))return;let u=null;o.tool==="transform"?u=await this._getReshape([p],i,n):o.tool==="reshape"&&(u=await this._getBox([p],i,n)),P(u)||(o.activeComponent?.destroy(),o.activeComponent=u,o.activeComponent&&(ie(s),s=this._getHandlesForComponent(o,i)))}}),a=[n.on("immediate-click",p=>this._getCommonUpdateOperationClickHandlers(o,p,i),A.WIDGET),n.on("key-down",p=>{if(this._getCommonUpdateOperationKeyDownHandlers(o,p),p.key===M.constraint&&!p.repeat&&o){const l=o.activeComponent;l&&l.type==="box"&&(l.preserveAspectRatio=!l.preserveAspectRatio)}},A.WIDGET),n.on("key-up",p=>{if(p.key===M.constraint&&o){const l=o.activeComponent;l&&l.type==="box"&&(l.preserveAspectRatio=!l.preserveAspectRatio)}},A.WIDGET)];let s=this._getHandlesForComponent(o,i);return o}async _getGraphicMover(t,e,i){const{enableMoveAllGraphics:n,highlightOptions:r}=e,o=await this._requireModule(D(()=>import("./GraphicMover-CDpVbWRg.js").then(a=>a.G),__vite__mapDeps([193,1,2,3,15,16,17,18,19,20,21,22,23,24,10,25,7,8,122,27,28,29,62,120,9,12,14,31,6,90]),import.meta.url));return P(o)?o:new o.module.default({enableMoveAllGraphics:n,highlightName:r?.name,highlightsEnabled:!!r?.enabled,indicatorsEnabled:!1,graphics:t,view:i,callbacks:{onGraphicMoveStart:({dx:a,dy:s,graphic:p})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:s,mover:p,type:"move-start"},type:"update"})},onGraphicMove:({dx:a,dy:s,graphic:p})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:s,mover:p,type:"move"},type:"update"}),onGraphicMoveStop:({dx:a,dy:s,graphic:p})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:s,mover:p,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayMoveCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(t,e,i){const{enableRotation:n,enableScaling:r,highlightOptions:o,preserveAspectRatio:a}=e,[s,p]=await Promise.all([this._requireModule(D(()=>import("./Box-DAapV3GB.js"),__vite__mapDeps([194,1,2,3,5,122,193,15,16,17,18,19,20,21,22,23,24,10,25,7,8,27,28,29,62,120,9,12,14,31,6,90,195,72,33,73,74,42,75,41,43,37,76,77,78,79,80,81,82,83,84,85,86,4,87,88,89,91,92,93,166,161,13,26,11,30,32,34,35,36,38,39,40,44,45,46,47,48,49,50,51]),import.meta.url)),$e()]);if(P(s))return s;const l=this.view?.inputManager?.isModifierKeyDown(M.constraint);return new s.module.default({graphics:t,enableRotation:n,enableScaling:r,highlightName:o?.name,highlightsEnabled:!!o?.enabled,preserveAspectRatio:!!a!=!!l,layer:this._internalGraphicsLayer,view:i,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:p,callbacks:{onMoveStart:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onMove:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onMoveStop:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onScaleStart:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onScale:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onScaleStop:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onRotateStart:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onRotate:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onRotateStop:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"})}})}async _getReshape(t,e,i){const{highlightOptions:n,reshapeOptions:r}=e,o=r?.edgeOperation==="split",a=r?.shapeOperation==="move",[s,p,l]=await Promise.all([this._requireModule(D(()=>import("./Reshape-9irFwQHr.js"),__vite__mapDeps([196,1,2,3,33,15,16,17,18,19,20,21,22,23,24,10,25,7,8,111,68,9,11,69,70,71,12,5,72,73,74,42,75,41,43,37,76,77,78,27,28,29,79,80,81,82,83,84,85,86,4,87,88,89,62,90,91,92,93,13,197,162,117,118,119,163,164,121,38,198,107,199,200,177,159,122,193,120,14,31,6,161,195,112,39,40,26,30,32,34,35,36,44,45,46,47,48,49,50,51]),import.meta.url)),lt(),$e()]);return P(s)?s:new s.module.default({enableMidpoints:o,enableMovement:a,graphic:t[0],highlightName:n?.name,highlightsEnabled:!!n?.enabled,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:p,automaticLengthMeasurementUtils:l,view:i,callbacks:{onReshapeStart:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onReshape:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onReshapeStop:({mover:u,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:u,type:d},type:"update"}),onMoveStart:({dx:u,dy:d,mover:v,type:y})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:u,dy:d,mover:v,type:y},type:"update"}),onMove:({dx:u,dy:d,mover:v,type:y})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:u,dy:d,mover:v,type:y},type:"update"}),onMoveStop:({dx:u,dy:d,mover:v,type:y})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:u,dy:d,mover:v,type:y},type:"update"}),onVertexAdd:({added:u,type:d,vertices:v})=>{const y=u.map(f=>xi(f.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:y,vertices:v,type:d},type:"update"})},onVertexRemove:({removed:u,type:d,vertices:v})=>{const y=u.map(f=>xi(f.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:y,vertices:v,type:d},type:"update"})}}})}_getHandlesForComponent(t,e){const i=t.activeComponent;if(!i)return[];switch(i.type){case"graphic-mover":return[i.on("graphic-click",({graphic:n,viewEvent:r})=>{r.native?.shiftKey&&e.multipleSelectionEnabled&&(r.stopPropagation(),t.removeFromSelection(n))}),i.on("graphic-move-start",n=>t.addToHistory(me(n.allGraphics)))];case"box":return[i.on("graphic-click",n=>this._onTransformOrReshape2DGraphicClick(t,e,n)),i.on("move-start",n=>t.addToHistory(me(n.graphics))),i.on("rotate-start",n=>t.addToHistory(me(n.graphics))),i.on("scale-start",n=>t.addToHistory(me(n.graphics)))];case"reshape":return[i.on("graphic-click",n=>this._onTransformOrReshape2DGraphicClick(t,e,n)),i.on("move-start",n=>t.addToHistory(me([n.mover]))),i.on("reshape-start",n=>t.addToHistory(me([n.graphic]))),i.on("vertex-add",n=>t.addToHistory(me([n.oldGraphic]))),i.on("vertex-remove",n=>t.addToHistory(me([n.oldGraphic])))];case"move-3d":return[i.events.on("record-undo",({updates:n})=>{t.addToHistory({updates:n})}),i.events.on("move-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move-start"},type:"update"})}),i.events.on("move",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n.dx,dy:n.dy,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move"},type:"update"})}),i.events.on("move-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move-stop"},type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],t,e):t.toggleTool()})];case"transform-3d":return[i.events.on("record-undo",({updates:n})=>{t.addToHistory({updates:n})}),i.events.on("translate-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move-start"},type:"update"})}),i.events.on("translate-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move-stop"},type:"update"})}),i.events.on("rotate-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate-start"},type:"update"})}),i.events.on("rotate-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate-stop"},type:"update"})}),i.events.on("scale-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale-start"},type:"update"})}),i.events.on("scale-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale-stop"},type:"update"})}),i.events.on("translate",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move"},type:"update"})}),i.events.on("rotate",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate"},type:"update"})}),i.events.on("scale",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale"},type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],t,e):t.toggleTool()})];case"reshape-3d":return[i.events.on("reshape",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n,mover:n.object.graphic},type:"update"})}),i.events.on("move",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n,mover:n.object.graphic},type:"update"})}),i.events.on("vertex-add",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:n,type:"update"})}),i.events.on("vertex-remove",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:n,type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],t,e):t.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(t,e,i){const{graphic:n,viewEvent:r}=i;return r.native?.shiftKey&&n.layer===this.layer?(r.stopPropagation(),t.removeFromSelection(n)):e.toggleToolOnClick?(r.stopPropagation(),t.toggleTool()):void 0}_setUpdateOperationHandle(t,e){this._operationHandle=t;const i=this.view?.map;this._disablePopup(e);const n=()=>{if(t===this._operationHandle){const r=this.updateGraphics.toArray(),o=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(e),this.emit("update",{graphics:r,state:"complete",aborted:t.cancelled,tool:o,toolEventInfo:null,type:"update"})}};t.on("complete",n)}async _getCommonUpdateOperationClickHandlers(t,e,i){const n=Ii(e),r=await e.defer(()=>this._getFirstHit(n));if(r==null)return void t.complete();if(e.native.shiftKey&&this._toggleSelection([r.graphic],t,i))return void e.stopPropagation();this.updateGraphics.includes(r.graphic)?e.stopPropagation():t.complete()}_toggleSelection(t,e,i){const n=!!i.multipleSelectionEnabled;return t.some(r=>r!=null&&!(!n||r.layer!==this.layer)&&(this.updateGraphics.includes(r)?e.removeFromSelection(r):e.addToSelection(r),!0))}_getCommonUpdateOperationKeyDownHandlers(t,e){if(!t)return;const i=e.key;i===M.undo&&t.canUndo()?(e.stopPropagation(),t.undo()):i===M.redo&&t.canRedo()?(e.stopPropagation(),t.redo()):i===M.cancel?(e.stopPropagation(),t.cancel()):this.allowDeleteKey&&M.delete.includes(i)&&this._onDeleteKey(e)}_onDeleteKey(t){if(!this._operationHandle||this._operationHandle.type!=="update")return;const e=this.activeComponent,i=this.updateGraphics.toArray();e!=null&&(e.type!=="reshape"||i.length===1&&i[0].geometry?.type==="point")&&(t.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=rt(this._internalGraphicsLayer))}_isComponentGraphic(t){const{activeComponent:e}=this;return!(!t||e==null)&&(t.attributes?.esriSketchTool||e.type==="draw-2d"&&e.graphic===t||(e.type==="box"||e.type==="reshape")&&e.isUIGraphic(t))}_displayPointerCursor(){this.view?.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view?.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayMoveCursor(){this.view?.container&&this.view.cursor!=="move"&&(this.view.cursor="move")}_displayDefaultCursor(){this.view?.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(t,e,i){on.getLogger(this).error(new Ar(t,e,i))}async _requireModule(t){const e=new AbortController;this._moduleLoaderAbortController=e;const i=await t;return this._moduleLoaderAbortController!==e||e.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(t){this.emit("undo",{...t,type:"undo"})}_emitRedoEvent(t){this.emit("redo",{...t,type:"redo"})}_emitDeleteEvent(t){this.emit("delete",{...t,type:"delete"})}get test(){}wait(){return Ci(()=>!this.updating)}_disablePopupEnabled(t){return this.view?.type!=="3d"||this.updateOnGraphicClick||(t?.toggleToolOnClick??!1)}_disablePopup(t){this._disablePopupEnabled(t)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(t){this._disablePopupEnabled(t)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const t=this.view;t?(jt(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await Gr(Ci(()=>t?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",tn("view"))}_logMissingLayer(){this._logError(ba,tn("layer"))}};c([h()],E.prototype,"_defaultSnappingManager",void 0),c([h()],E.prototype,"updating",null),c([h({readOnly:!0})],E.prototype,"_updatingHandles",void 0),c([h()],E.prototype,"_operationHandle",void 0),c([h({readOnly:!0})],E.prototype,"activeTool",null),c([h({readOnly:!0})],E.prototype,"activeCreateToolDrawMode",null),c([h()],E.prototype,"activeTooltip",null),c([h({types:Ue})],E.prototype,"activeFillSymbol",void 0),c([h()],E.prototype,"activeLineSymbol",void 0),c([h()],E.prototype,"activeVertexSymbol",void 0),c([h()],E.prototype,"allowDeleteKey",void 0),c([h({readOnly:!0})],E.prototype,"createGraphic",null),c([h()],E.prototype,"defaultCreateOptions",null),c([h()],E.prototype,"defaultUpdateOptions",null),c([h({type:di,nonNullable:!0})],E.prototype,"labelOptions",null),c([h()],E.prototype,"layer",void 0),c([h({types:Ue})],E.prototype,"pointSymbol",void 0),c([h({types:Ue})],E.prototype,"polygonSymbol",void 0),c([h({types:Ue})],E.prototype,"polylineSymbol",void 0),c([h()],E.prototype,"meshSymbol",void 0),c([h({type:G,nonNullable:!0})],E.prototype,"snappingOptions",null),c([h()],E.prototype,"snappingManager",null),c([h({readOnly:!0})],E.prototype,"state",null),c([h({type:yi,nonNullable:!0})],E.prototype,"tooltipOptions",null),c([h({readOnly:!0})],E.prototype,"updateGraphics",void 0),c([h()],E.prototype,"updateOnGraphicClick",void 0),c([h()],E.prototype,"creationMode",void 0),c([h({type:hi,nonNullable:!0})],E.prototype,"valueOptions",null),c([h({types:Ue})],E.prototype,"vertexSymbol",void 0),c([h({value:null})],E.prototype,"view",null),c([h({constructOnly:!0,type:Tn})],E.prototype,"sketchOptions",void 0),E=c([I("esri.widgets.Sketch.SketchViewModel")],E);const ba="sketch:missing-property",tn=t=>`Property '${t}' is missing on SketchViewModel.`;function wa(t){return t==="polygon"||t==="rectangle"||t==="circle"}function ut(t,e){Xn("undo",t.history.undo,t.history.redo,e)}function ht(t,e){Xn("redo",t.history.redo,t.history.undo,e)}function Xn(t,e,i,n){const r=e.pop();if(!r)return;const o=r.updates,a=[];n.forEach((s,p)=>{const l=o[p];l!=null&&("geometry"in l&&l.geometry!=null&&(a.push({geometry:s.geometry}),s.geometry=l.geometry),"symbol"in l&&l.symbol!=null&&(a.push({symbol:s.symbol}),s.symbol=l.symbol),"undo"in l&&(a.push(l),l[t](s)))}),i.push({updates:a})}function nn(t,e){t!=null&&e.hasGrabbedManipulators&&(t.activeTool=null)}function me(t){return{updates:t.map(({geometry:e})=>e?.type==="mesh"?{geometry:e.cloneShallow()}:{geometry:e})}}function dt(t,e){t.tools?.remove(e),e.destroyed||e.destroy()}function P(t){return"requireError"in t&&t.requireError==="aborted"}export{qe as $,il as A,ll as B,On as C,El as D,jo as E,Ao as F,R as G,Cs as H,wl as I,Gn as J,Pt as K,Tl as L,Qa as M,zi as N,Ns as O,Gs as P,le as Q,Hl as R,xs as S,Bn as T,Go as U,U as V,Ui as W,Nl as X,$e as Y,lt as Z,G as _,Ht as a,qi as a0,Tt as a1,as as a2,Hn as a3,Oi as a4,ns as a5,Po as a6,ls as a7,di as a8,Q as a9,zo as aa,da as ab,Ja as ac,Sl as ad,Xa as ae,ye as af,hi as ag,Xi as ah,ma as ai,Is as aj,ul as ak,hl as al,cl as am,K as an,Do as ao,b as ap,kl as aq,fa as ar,gt as b,q as c,vl as d,Ft as e,Sn as f,Ps as g,As as h,Se as i,ke as j,E as k,Tn as l,tl as m,zn as n,bl as o,St as p,N as q,Ls as r,pl as s,Fi as t,Ds as u,Ol as v,Mt as w,Hs as x,_l as y,ml as z};
