const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./knowledgeGraphService-qPb3h2Q_.js","./main-CVnirFib.js","./preload-helper-DMGCcr4D.js","./main-DLalkaVh.css","./normalizeUtils-BJH_S_YS.js","./Cyclical-BoF4V2-b.js","./normalizeUtilsCommon-UTi5gVBV.js","./utils-DOxRqsmA.js","./utils-CYSB1Qa_.js","./Field-DHHGy5SY.js","./fieldType-DsDQaQ1D.js","./networkEnums-BCVWhX2K.js","./FeatureSet-DC9oZtKv.js","./GPMessage-DS7XYtXP.js","./Relationship-DbQIGTv7.js"])))=>i.map(i=>d[i]);
import{_ as G}from"./preload-helper-DMGCcr4D.js";import{M as _,eX as g,eZ as S,e2 as A,eY as x,B as N,ac as q,D as I,e_ as J,e$ as j}from"./main-CVnirFib.js";import{t as B}from"./arcade-D7CcUWyD.js";import{o as P,g as T,k as L,z as W,p as b,c as Q,l as k,m as V,w as O,K as U,U as E}from"./Dictionary-B0I5YIiq.js";import{n as l}from"./enum-Brb2BolR.js";import{l as z}from"./portalUtils-BgQoabr2.js";import{L as C,W as X,G as Y}from"./projectionUtils-_ztrzQpZ.js";import Z from"./PortalItem-Ywdiqt8p.js";import{p as H,n as $}from"./project-ygt4W7t4.js";import{p as tt,a as et,e as rt,i as nt,b as it}from"./Relationship-DbQIGTv7.js";import"./arcadeEnvironment-ndkjWfXm.js";import"./Feature-R-S3cBO6.js";import"./TimeOnly-Cr3AjrIl.js";import"./UnknownTimeZone-BhqG-N22.js";import"./featureConversionUtils-CmlHLWab.js";import"./OptimizedFeature-CKx0QTkI.js";import"./memoryEstimations-B-NVk6Py.js";import"./OptimizedGeometry-DXTntBcH.js";import"./OptimizedFeatureSet-BR8EEvDc.js";import"./FieldsIndex-E0QEVyh6.js";import"./timeZoneUtils-CTymOneK.js";import"./aiServices-D7vFTysM.js";import"./commonProperties-DHiB1uzW.js";import"./utils-DOxRqsmA.js";import"./ImmutableArray-BPVd6ESQ.js";import"./shared-BiRyErG1.js";import"./Field-DHHGy5SY.js";import"./fieldType-DsDQaQ1D.js";import"./WhereClause-DLR8topf.js";import"./streamLayerUtils-DFlbJ4P1.js";import"./unitConversion-tkuz0lpR.js";import"./number-Bd_0lRPV.js";import"./uuid-Oe6SV2kF.js";import"./projectBuffer-DI41PaBj.js";import"./zscale-B46pqN4h.js";import"./utils-CYSB1Qa_.js";let u=null;async function ot(t){const e=q.geometryServiceUrl??"";if(!e){Y()||await C();for(const r of t)r.container[r.indexer]=X(r.container[r.indexer],I.WGS84);return}const n=t.map(r=>r.container[r.indexer]),o=new H({geometries:n,outSpatialReference:I.WGS84}),s=await $(e,o);for(let r=0;r<s.length;r++){const i=t[r];i.container[i.indexer]=s[r]}}async function D(t,e){const n=new Z({portal:t,id:e});return await n.load(),u===null&&(u=await G(()=>import("./knowledgeGraphService-qPb3h2Q_.js").then(o=>o.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url)),await u.fetchKnowledgeGraph(n.url)}function v(t,e,n,o,s){if(t===null)return null;if(g(t)||A(t))return t;if(k(t)||k(t))return t.toJSDate();if(V(t))return t.toStorageFormat();if(O(t))return t.toStorageString();if(U(t)){const r={};for(const i of t.keys())r[i]=v(t.field(i),e,n,o,s),r[i]instanceof x&&s.push({container:r,indexer:i});return r}if(S(t)){const r=t.map(i=>v(i,e,n,o,s));for(let i=0;i<r.length;i++)r[i]instanceof x&&s.push({container:r,indexer:i});return r}return E(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&e?N(t):t:void 0}function at(t,e){if(!t)return t;if(t.spatialReference.isWGS84&&e.spatialReference.isWebMercator)return j(t);if(t.spatialReference.equals(e.spatialReference))return t;throw new l(e,"WrongSpatialReference",null)}function y(t,e){if(!t)return null;const n={};for(const o in t)n[o]=c(t[o],e);return n}function c(t,e){return t===null?null:S(t)?t.map(n=>c(n,e)):t instanceof et?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:y(t.properties,e)}:t instanceof rt?{graphType:"object",properties:y(t.properties,e)}:t instanceof nt?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:y(t.properties,e)}:t instanceof it?{graphType:"path",path:t.path?t.path.map(n=>c(n,e)):null}:E(t)?at(t,e):g(t)||A(t)||J(t)?t:null}function Qt(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(e,n){return t.standardFunctionAsync(e,n,(o,s,r)=>{if(P(r,2,2,e,n),r[0]===null)throw new l(e,"PortalRequired",n);if(r[0]instanceof B){const m=T(r[1]);let f;return f=e.services?.portal?e.services.portal:_.getDefault(),D(z(r[0],f),m)}if(g(r[0])===!1)throw new l(e,"InvalidParameter",n);const i=T(r[0]);return D(e.services?.portal??_.getDefault(),i)})},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(e,n){return t.standardFunctionAsync(e,n,async(o,s,r)=>{P(r,2,4,e,n);const i=r[0];if(!L(i))throw new l(e,"InvalidParameter",n);const m=r[1];if(!g(m))throw new l(e,"InvalidParameter",n);u===null&&(u=await G(()=>import("./knowledgeGraphService-qPb3h2Q_.js").then(a=>a.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url));let f=null;const d=W(r[2],null);if(!(d instanceof b||d===null))throw new l(e,"InvalidParameter",n);if(d){let a=[];f=v(d,!0,!1,e,a),a=a.filter(p=>!p.container[p.indexer].spatialReference.isWGS84),a.length>0&&await ot(a)}const F=W(r[3],!1),R=new tt({openCypherQuery:m,bindParameters:f,provenanceBehavior:F?"include":"exclude"});(i?.serviceDefinition?.currentVersion??11.3)>11.2&&(R.outputSpatialReference=e.spatialReference);const K=(await u.executeQueryStreaming(i,R)).resultRowsStream.getReader(),w=[];try{for(;;){const{done:a,value:p}=await K.read();if(a)break;if(S(p))for(const h of p)w.push(c(h,e));else{const h=[];for(const M of p)h.push(c(p[M],e));w.push(h)}}}catch(a){throw a}return b.convertJsonToArcade(w,Q(e),!1,!0)})},t.signatures.push({name:"querygraph",min:2,max:4}))}export{Qt as registerFunctions};
